<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–ú–æ—è –ª—é–±–∏–º–∞—è –ë–∏–±–∞</title>
    
    <!-- iOS PWA -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ffffff">
    <link rel="apple-touch-icon" href="https://img.icons8.com/dusk/64/000000/heart-with-arrow.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@600;700&family=Nunito:wght@600;700;800;900&family=SF+Mono:wght@500&family=Roboto+Mono:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --card-light: rgba(255, 255, 255, 0.75);
            --card-border-light: rgba(255, 255, 255, 0.6);
            --text-main-light: #1d1d1f;
            --text-sub-light: #424245;
            
            --card-dark: rgba(30, 30, 35, 0.9);
            --card-border-dark: rgba(255, 255, 255, 0.15);
            --text-main-dark: #f5f5f7;
            --text-sub-dark: #a0a0a5;

            --accent: #ff3b30;
            --accent-glow: rgba(255, 59, 48, 0.5);
            --holiday-color: #ff9500;
            
            --blur: blur(30px);
            --shadow: 0 10px 40px -10px rgba(0,0,0,0.15);
            
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #f5f5f7;
            color: var(--text-main-light);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            background: transparent;
            user-select: none;
            transition: color 0.3s;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* --- DYNAMIC BACKGROUNDS --- */
        .bg-mesh {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            z-index: -2;
            opacity: 0; transition: opacity 0.8s ease-in-out;
            background-size: cover;
        }
        .bg-mesh.active { opacity: 1; }

        #bg-snow {
            background: radial-gradient(at 30% 0%, #dbeafe 0%, transparent 60%), 
                        radial-gradient(at 70% 0%, #bfdbfe 0%, transparent 60%),
                        #eff6ff;
        }
        #bg-spring {
            background: radial-gradient(at 10% 10%, #ffe4e6 0%, transparent 50%), 
                        radial-gradient(at 90% 0%, #fecdd3 0%, transparent 50%),
                        #fff1f2;
        }
        #bg-rain {
            background: radial-gradient(at 50% 0%, #94a3b8 0%, transparent 70%),
                        #cbd5e1;
        }

        body.dark-mode { color: var(--text-main-dark); }
        body.dark-mode #bg-snow { background: radial-gradient(circle at 50% -20%, #172a45 0%, #0a0a0a 80%); }
        body.dark-mode #bg-spring { background: radial-gradient(circle at 50% -20%, #3e1f26 0%, #0a0a0a 80%); }
        body.dark-mode #bg-rain { background: radial-gradient(circle at 50% -20%, #252b36 0%, #050505 80%); }

        #canvas-fx { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }

        /* --- GARLAND --- */
        .garland-wrap {
            position: fixed; top: 0; left: 0; width: 100%; height: 60px; z-index: 100;
            display: flex; justify-content: space-between; pointer-events: none;
            opacity: 0; transition: opacity 0.5s; padding: 0 20px;
        }
        .garland-wrap.active { opacity: 1; }
        .string-segment {
            flex: 1; position: relative; border-top: 1px solid rgba(80, 80, 80, 0.5);
            border-radius: 50%; height: 20px; margin-top: -8px;
            display: flex; justify-content: space-around; transform-origin: top center;
            animation: gentleSway 5s ease-in-out infinite alternate;
        }
        .dark-mode .string-segment { border-top-color: rgba(255,255,255,0.2); }
        .micro-led { width: 4px; height: 4px; border-radius: 50%; margin-top: -2px; background: #fff; position: relative; }
        .led-warm { background: #ffb347; box-shadow: 0 0 6px #ff9e2c; }
        .led-cool { background: #5bc0de; box-shadow: 0 0 6px #2a9fd6; }
        .led-pink { background: #ff69b4; box-shadow: 0 0 6px #ff1493; }
        .dark-mode .led-warm { background: #ffdfba; box-shadow: 0 0 15px #ffdfba; }
        .dark-mode .led-cool { background: #cceeff; box-shadow: 0 0 15px #cceeff; }
        .dark-mode .led-pink { background: #ffbbcc; box-shadow: 0 0 15px #ffbbcc; }
        @keyframes gentleSway { from { transform: rotate(-1deg) translateY(0); } to { transform: rotate(1deg) translateY(2px); } }

        /* --- CONTROLS --- */
        .control-dock {
            position: fixed; top: calc(15px + var(--safe-top)); left: 50%; transform: translateX(-50%);
            background: rgba(240, 240, 240, 0.6); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            padding: 4px; border-radius: 100px; display: flex; gap: 6px; z-index: 200;
            border: 1px solid rgba(255,255,255,0.4); box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .dark-mode .control-dock { background: rgba(40,40,40,0.6); border-color: rgba(255,255,255,0.1); }
        .dock-btn {
            width: 42px; height: 42px; border-radius: 50%; border: none; background: transparent;
            font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s; position: relative;
        }
        .dock-btn.active { background: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transform: scale(1.05); }
        .dark-mode .dock-btn.active { background: rgba(255,255,255,0.2); }
        .dock-btn:active { transform: scale(0.95); }
        .coin-badge {
            position: absolute; top: -5px; right: -5px; background: #FFD700; color: #000;
            font-size: 10px; font-weight: 800; padding: 2px 5px; border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); min-width: 15px;
        }

        /* --- LAYOUT --- */
        .app-layout {
            max-width: 500px; margin: 0 auto; padding: calc(90px + var(--safe-top)) 20px 100px;
            position: relative; z-index: 10;
        }
        .view-section { display: none; animation: fadeIn 0.4s ease; }
        .view-section.active-view { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        header { text-align: center; margin-bottom: 30px; }
        h1 {
            font-family: 'Caveat', cursive; font-size: 60px; margin: 0; line-height: 0.9;
            color: var(--text-main-light); text-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .dark-mode h1 { color: var(--text-main-dark); text-shadow: 0 2px 20px rgba(0,0,0,0.8); }
        .subtitle {
            font-size: 14px; font-weight: 800; text-transform: uppercase; letter-spacing: 2px;
            color: var(--text-sub-light); margin-top: 10px;
        }
        .dark-mode .subtitle { color: var(--text-sub-dark); }

        /* --- GLASS PANEL --- */
        .glass-panel {
            background: var(--card-light); backdrop-filter: var(--blur); -webkit-backdrop-filter: var(--blur);
            border: 1px solid var(--card-border-light); border-radius: 32px; padding: 24px; margin-bottom: 24px;
            box-shadow: var(--shadow); transition: background 0.3s, border-color 0.3s;
        }
        .dark-mode .glass-panel { background: var(--card-dark); border-color: var(--card-border-dark); box-shadow: 0 10px 40px rgba(0,0,0,0.4); }

        /* --- FLIGHT --- */
        .flight-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px; }
        .city-code { font-size: 32px; font-weight: 900; line-height: 1; letter-spacing: -1px; }
        .city-name { font-size: 13px; font-weight: 700; text-transform: uppercase; color: var(--text-sub-light); }
        .dark-mode .city-name { color: var(--text-sub-dark); }
        #flight-viz { width: 100%; height: 130px; position: relative; }
        .track-path { fill: none; stroke: var(--text-sub-light); stroke-width: 2; stroke-dasharray: 6 6; opacity: 0.3; }
        .active-path { fill: none; stroke: var(--accent); stroke-width: 3; stroke-linecap: round; filter: drop-shadow(0 0 8px var(--accent-glow)); }
        #plane-wrapper {
            position: absolute; top: 0; left: 0; width: 40px; height: 40px; will-change: transform; pointer-events: auto;
            display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer;
        }
        .plane-emoji { font-size: 38px; line-height: 1; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2)); transform: rotate(90deg); transition: transform 0.5s; }
        @keyframes barrelRoll { 0% { transform: rotate(90deg); } 100% { transform: rotate(450deg); } }
        .pct-pill {
            position: absolute; top: -30px; background: rgba(255,255,255,0.9); backdrop-filter: blur(12px);
            padding: 5px 12px; border-radius: 12px; font-family: 'Roboto Mono', monospace; font-size: 12px;
            font-weight: 700; color: #000; box-shadow: 0 4px 15px rgba(0,0,0,0.1); white-space: nowrap;
        }
        .dark-mode .pct-pill { background: rgba(60,60,60,0.9); color: #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.4); }

        /* TIMER & CALENDAR */
        .countdown {
            text-align: center; font-family: 'Roboto Mono', monospace; font-size: 32px; font-weight: 700;
            margin-top: 15px; color: var(--text-main-light); letter-spacing: -1px;
        }
        .dark-mode .countdown { color: var(--text-main-dark); }
        .timer-caption { text-align: center; font-size: 13px; color: var(--text-sub-light); margin-bottom: 5px; font-weight: 700; }
        .dark-mode .timer-caption { color: var(--text-sub-dark); }
        .dates-meta { display: flex; justify-content: space-between; font-size: 12px; font-weight: 800; color: var(--text-sub-light); opacity: 0.6; margin-top: 20px; }
        .dark-mode .dates-meta { color: var(--text-sub-dark); opacity: 0.8; }

        /* CALENDAR GRID */
        .month-title { font-size: 20px; font-weight: 900; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .week-header { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin-bottom: 8px; }
        .week-day { text-align: center; font-size: 11px; font-weight: 800; color: var(--text-sub-light); opacity: 0.5; }
        .dark-mode .week-day { color: var(--text-sub-dark); }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
        .day-item {
            aspect-ratio: 1; border-radius: 14px; background: rgba(0,0,0,0.03);
            display: flex; justify-content: center; align-items: center;
            font-size: 16px; font-weight: 800; color: var(--text-sub-light);
            position: relative; cursor: pointer; transition: all 0.2s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .dark-mode .day-item { background: rgba(255,255,255,0.06); color: var(--text-main-dark); }
        .day-item.future { opacity: 0.3; cursor: default; }
        .day-item.today { background: transparent; border: 2px solid var(--accent); color: var(--accent); box-shadow: 0 0 20px var(--accent-glow); z-index: 2; transform: scale(1.1); }
        .day-item.holiday { border: 1px solid var(--holiday-color); color: var(--holiday-color); }
        .day-item.opened { background: var(--accent); color: #fff; border-color: var(--accent); box-shadow: 0 5px 15px var(--accent-glow); }
        .day-item.missed { background: transparent; border: 1px dashed var(--accent); color: var(--accent); }
        .day-item:active { transform: scale(0.92); }
        .mini-heart { position: absolute; bottom: 3px; right: 3px; font-size: 9px; color: rgba(255,255,255,0.9); animation: heartBeat 1.5s infinite; }
        @keyframes heartBeat { 0% { transform: scale(1); } 15% { transform: scale(1.3); } 30% { transform: scale(1); } 45% { transform: scale(1.3); } 100% { transform: scale(1); } }
        .holiday-icon { position: absolute; top: -6px; right: -6px; font-size: 12px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2)); z-index: 3; }

        /* --- MODAL --- */
        .modal-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            z-index: 2000; opacity: 0; pointer-events: none; transition: opacity 0.3s;
            display: flex; align-items: center; justify-content: center; padding: 20px;
        }
        .modal-layer.active { opacity: 1; pointer-events: all; }
        .letter-box {
            background: #fff; width: 100%; border-radius: 40px; padding: 32px; text-align: center;
            transform: scale(0.9) translateY(40px); transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
        }
        .dark-mode .letter-box { background: #1c1c1e; color: #fff; border: 1px solid rgba(255,255,255,0.1); }
        .modal-layer.active .letter-box { transform: scale(1) translateY(0); }
        .quote-text { font-family: 'Caveat', cursive; font-size: 34px; line-height: 1.3; margin: 24px 0; color: #1d1d1f; }
        .dark-mode .quote-text { color: #f5f5f7; }

        .action-btn {
            background: #1d1d1f; color: #fff; border: none; width: 100%; padding: 18px;
            border-radius: 24px; font-weight: 800; font-size: 16px; cursor: pointer; transition: transform 0.2s;
        }
        .dark-mode .action-btn { background: #fff; color: #000; }
        .action-btn:active { transform: scale(0.97); }

        /* --- TOAST --- */
        .toast-pill {
            position: fixed; bottom: 40px; left: 50%; transform: translate(-50%, 150px);
            background: rgba(255,255,255,0.95); backdrop-filter: blur(20px);
            padding: 14px 28px; border-radius: 50px; font-weight: 700; color: #000;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2); z-index: 3000;
            display: flex; align-items: center; gap: 10px; white-space: nowrap;
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .toast-pill.visible { transform: translate(-50%, 0); }

        /* --- PET GAME STYLES --- */
        .pet-stage {
            height: 380px; display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; overflow: visible; border-radius: 24px; transition: all 0.5s;
        }
        .house-bg {
            position: absolute; top:0; left:0; width:100%; height:100%; z-index: 0; opacity: 0.3; font-size: 150px; 
            display: flex; align-items: center; justify-content: center; pointer-events: none; transition: all 0.5s;
        }
        .rent-info-text {
            position: absolute; top: 40px; left: 50%; transform: translateX(-50%);
            font-size: 12px; font-weight: 800; color: var(--text-sub-light); opacity: 0.9; z-index: 10;
            background: rgba(255,255,255,0.6); padding: 4px 12px; border-radius: 12px; backdrop-filter: blur(5px);
            display: none; white-space: nowrap; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .dark-mode .rent-info-text { color: var(--text-sub-dark); background: rgba(0,0,0,0.6); box-shadow: 0 2px 10px rgba(0,0,0,0.3); }

        .pet-blob {
            width: 140px; height: 130px; background: #fff; border-radius: 50% 50% 45% 45%;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1); position: relative; transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex; align-items: center; justify-content: center; animation: breathe 3s infinite ease-in-out;
            cursor: pointer; z-index: 2;
        }
        .pet-blob.sleeping { animation: breathe 6s infinite ease-in-out; opacity: 0.9; }
        .pet-blob.sad { filter: grayscale(0.5) contrast(0.9); animation: sadShake 3s infinite; }
        .pet-blob.walking { animation: walk 4s infinite linear; }
        .pet-blob:active { transform: scale(0.9) translateY(5px); }
        .dark-mode .pet-blob { background: #f0f0f5; box-shadow: 0 15px 40px rgba(0,0,0,0.5); }
        
        .pet-face { font-size: 50px; position: relative; z-index: 20; pointer-events: none; }
        
        /* ACCESSORIES POSITIONING REWORKED - ABSOLUTE CONTAINER */
        /* This container sits EXACTLY on top of the blob */
        #pet-acc-root { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
        }
        
        .acc-item { position: absolute; display: flex; justify-content: center; width: 100%; }

        /* Head (Hats): Top layer */
        .acc-head { top: -50px; font-size: 55px; z-index: 30; text-shadow: 0 5px 10px rgba(0,0,0,0.1); }
        
        /* Eyes (Glasses): Above face */
        .acc-eyes { top: 30px; font-size: 45px; z-index: 25; }
        
        /* Neck (Scarves): Below face (z20), Above body (z10) */
        .acc-neck { top: 75px; font-size: 55px; z-index: 15; text-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        /* Body (Clothes): Bottom layer */
        .acc-body { bottom: -8px; font-size: 110px; z-index: 10; opacity: 1; }

        .pet-zzz { position: absolute; top: -30px; right: -10px; font-size: 24px; font-weight: 800; color: var(--text-sub-light); opacity: 0; }
        .sleeping .pet-zzz { opacity: 1; animation: floatZ 2s infinite; }

        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03) translateY(-3px); } }
        @keyframes sadShake { 0%,100% {transform: rotate(0);} 25% {transform: rotate(-3deg);} 75% {transform: rotate(3deg);} }
        @keyframes walk { 0% { transform: translateX(0) scale(1) rotate(0); } 25% { transform: translateX(30px) scale(0.95) rotate(5deg); } 50% { transform: translateX(0) scale(1) rotate(0); } 75% { transform: translateX(-30px) scale(0.95) rotate(-5deg); } 100% { transform: translateX(0) scale(1) rotate(0); } }
        @keyframes floatZ { 0% { transform: translate(0,0); opacity:0; } 50% { opacity:1; } 100% { transform: translate(10px, -20px); opacity:0; } }

        .click-float {
            position: absolute; font-weight: 800; font-size: 20px; color: #FFD700; pointer-events: none; z-index: 100;
            text-shadow: 0 2px 5px rgba(0,0,0,0.2); animation: floatUp 0.8s ease-out forwards;
            white-space: pre; text-align: center; line-height: 1.2;
        }
        @keyframes floatUp { to { transform: translateY(-70px); opacity: 0; } }
        
        .stat-bars { width: 100%; margin-top: 20px; display: flex; gap: 8px; justify-content: center; z-index: 5; position: relative; }
        .stat-col { display: flex; flex-direction: column; align-items: center; gap: 2px; flex: 1; }
        .stat-icon { font-size: 14px; }
        .stat-num { font-size: 10px; font-weight: 800; opacity: 0.6; font-family: 'SF Mono', monospace; margin-top: 2px; }
        
        .progress-bar { width: 100%; height: 6px; background: rgba(0,0,0,0.1); border-radius: 10px; overflow: hidden; position: relative; }
        .dark-mode .progress-bar { background: rgba(255,255,255,0.15); }
        .progress-fill { height: 100%; width: 0%; transition: width 0.5s ease-out; display: block; }
        .progress-fill.danger { background: #ff3b30 !important; animation: pulse 0.5s infinite alternate; }

        .game-info { display: flex; justify-content: space-between; width: 100%; margin-bottom: 5px; font-size: 12px; font-weight: 800; color: var(--text-sub-light); }
        .streak-fire { color: #FF9500; }

        .pet-thought {
            background: rgba(255,255,255,0.8); padding: 10px 15px; border-radius: 15px;
            position: absolute; top: 10px; font-size: 13px; font-weight: 800; color: #000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); opacity: 0; transform: translateY(10px);
            transition: all 0.3s; pointer-events: none; white-space: nowrap; z-index: 10;
        }
        .pet-thought.show { opacity: 1; transform: translateY(-10px); }

        .exp-container { width: 100%; margin-top: 5px; margin-bottom: 10px; display: flex; flex-direction: column; align-items: center; }
        .exp-bar { width: 80%; height: 4px; background: rgba(0,0,0,0.1); border-radius: 4px; overflow: hidden; }
        .exp-fill { height: 100%; background: linear-gradient(90deg, #32ade6, #007aff); width: 0%; transition: width 0.3s; }
        .lvl-text { font-size: 10px; font-weight: 800; color: var(--text-sub-light); margin-top: 3px; }

        .buffs-row { display: flex; gap: 5px; justify-content: center; margin-bottom: 5px; min-height: 20px; }
        .buff-icon {
            font-size: 12px; background: rgba(255,255,255,0.5); padding: 2px 6px; border-radius: 10px;
            border: 1px solid var(--accent); color: var(--accent); font-weight: 700; animation: pulse 1s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        .shop-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2500;
            background: rgba(0,0,0,0.5); backdrop-filter: blur(10px);
            display: none; align-items: center; justify-content: center; padding: 20px;
        }
        .shop-modal.active { display: flex; }
        .dark-mode .shop-modal .glass-panel { background: #1c1c1e; border: 1px solid rgba(255,255,255,0.15); box-shadow: 0 10px 50px rgba(0,0,0,0.5); }
        
        .shop-tabs { display: flex; gap: 5px; margin-bottom: 10px; overflow-x: auto; padding-bottom: 5px; }
        .shop-tab { padding: 5px 10px; border-radius: 10px; background: rgba(0,0,0,0.05); font-size: 11px; font-weight: 700; white-space: nowrap; cursor: pointer; }
        .shop-tab.active { background: var(--accent); color: #fff; }
        .shop-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-height: 300px; overflow-y: auto; }
        .shop-item {
            background: rgba(0,0,0,0.05); padding: 10px; border-radius: 15px;
            display: flex; flex-direction: column; align-items: center; gap: 5px; cursor: pointer;
            border: 2px solid transparent; text-align: center;
        }
        .dark-mode .shop-item { background: rgba(255,255,255,0.1); color: #fff; }
        .shop-item.owned { border-color: var(--accent); opacity: 0.7; }
        .shop-item.selected { background: var(--accent); color: #fff; }
        .shop-price { font-size: 11px; font-weight: 800; color: var(--holiday-color); }
        .shop-desc { font-size: 9px; opacity: 0.7; line-height: 1.1; margin-bottom: 4px; }

        .sleep-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,10,0.6); z-index: 40; pointer-events: none;
            display: none; border-radius: 24px;
            align-items: center; justify-content: center; color: #fff; font-size: 20px; font-weight: 800;
        }
        .sleep-overlay.active { display: flex; }

        /* --- CASINO (REAL WHEEL) --- */
        #view-casino {
            position: fixed; top:0; left:0; width:100%; height:100%; z-index: 2200;
            background: rgba(0,0,0,0.85); display: none;
            flex-direction: column; align-items: center; justify-content: center; padding: 20px;
        }
        #view-casino.active { display: flex; }
        .roulette-table {
            background: #0f4d19; padding: 20px; border-radius: 20px; border: 5px solid #d4af37;
            width: 100%; max-width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; align-items: center;
        }
        .wheel-container {
            width: 200px; height: 200px; border-radius: 50%; border: 8px solid #d4af37;
            position: relative; overflow: hidden; margin: 20px 0;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        .wheel {
            width: 100%; height: 100%; border-radius: 50%;
            background: conic-gradient(#2ecc71 0deg 24deg, #e74c3c 24deg 48deg, #333 48deg 72deg, #e74c3c 72deg 96deg, #333 96deg 120deg, #e74c3c 120deg 144deg, #333 144deg 168deg, #e74c3c 168deg 192deg, #333 192deg 216deg, #e74c3c 216deg 240deg, #333 240deg 264deg, #e74c3c 264deg 288deg, #333 288deg 312deg, #e74c3c 312deg 336deg, #333 336deg 360deg);
            transition: transform 3s cubic-bezier(0.1, 0.9, 0.2, 1);
        }
        .wheel-arrow {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent;
            border-top: 20px solid #fff; z-index: 10; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5));
        }
        .roulette-opts { display: flex; gap: 10px; justify-content: center; margin-top: 20px; width: 100%; }
        .r-btn { border: none; padding: 15px; border-radius: 10px; color: #fff; font-weight: 700; flex: 1; cursor: pointer; transition: transform 0.2s; }
        .r-btn:active { transform: scale(0.95); }
        .r-red { background: #d91e18; }
        .r-black { background: #111; border: 1px solid #444; }
        .r-green { background: #2ecc71; }
        .casino-input { padding: 10px; border-radius: 12px; border: none; width: 150px; text-align: center; font-size: 18px; font-weight: 700; margin-bottom: 20px; }

        .weather-badge {
            position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.7);
            padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: 700; z-index: 20;
            display: flex; align-items: center; gap: 5px;
        }
        
        .real-clock { font-size: 14px; font-weight: 800; color: var(--text-sub-light); margin-bottom: 5px; opacity: 0.8; }

        /* --- TRADING GAME (REPLACES BASKETBALL) --- */
        #view-trading {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #121212; z-index: 3000; display: none;
            flex-direction: column; align-items: center; padding-top: 30px; color: #fff;
        }
        #view-trading.active { display: flex; }
        .trading-card {
            background: #1e1e1e; width: 90%; max-width: 350px; padding: 20px;
            border-radius: 20px; border: 1px solid #333; display: flex; flex-direction: column; gap: 15px;
            overflow-y: auto; max-height: 85vh; /* Scroll Fix */
        }
        .chart-container { width: 100%; height: 150px; background: #000; border-radius: 10px; position: relative; overflow: hidden; flex-shrink: 0; }
        .trade-stat { display: flex; justify-content: space-between; font-size: 14px; color: #aaa; font-weight: 700; }
        .trade-val { color: #fff; font-size: 18px; font-family: 'SF Mono', monospace; }
        .trade-btns { display: flex; gap: 10px; margin-top: 10px; }
        .t-btn { flex: 1; padding: 15px; border-radius: 12px; font-weight: 800; border: none; font-size: 14px; cursor: pointer; color: #fff; transition: transform 0.1s; }
        .t-btn:active { transform: scale(0.95); }
        .t-buy { background: #30d158; }
        .t-sell { background: #ff453a; }
        .t-depo { background: #0a84ff; font-size: 12px; padding: 10px; }
        .t-with { background: #ff9500; font-size: 12px; padding: 10px; }
        
        .close-trading {
             position: absolute; top: 20px; right: 20px; background: #333; color: #fff; 
             width: 40px; height: 40px; border-radius: 50%; border: none; font-weight: 900;
             display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10;
        }
        
        .help-btn {
            position: absolute; top: 20px; left: 20px; background: rgba(255,255,255,0.2); color: #fff;
            width: 40px; height: 40px; border-radius: 50%; border: none; font-weight: 900;
            display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 20px; z-index: 10;
        }
        
        .trade-help-box {
            background: #333; padding: 15px; border-radius: 12px; font-size: 12px; color: #ccc;
            display: none; border: 1px solid #555; position: absolute; top: 70px; left: 20px; right: 20px; z-index: 20;
        }
        .trade-help-box.visible { display: block; }
        .trend-icon { font-size: 20px; margin-left: 5px; }
        
        .bank-section { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; margin-top: 10px; }
        .bank-row { display: flex; gap: 5px; margin-bottom: 10px; }
        .bank-input { flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #444; background: #000; color: #fff; font-weight: 700; text-align: center; }
        .max-btn { background: #333; color: #fff; border: 1px solid #555; padding: 0 10px; border-radius: 8px; font-size: 10px; font-weight: 800; cursor: pointer; }

    </style>
</head>
<body>

    <!-- Dynamic Backgrounds -->
    <div id="bg-snow" class="bg-mesh"></div>
    <div id="bg-spring" class="bg-mesh"></div>
    <div id="bg-rain" class="bg-mesh"></div>
    <canvas id="canvas-fx"></canvas>

    <div class="control-dock">
        <button class="dock-btn" onclick="setView('calendar')" id="btn-view-cal">üìÖ</button>
        <button class="dock-btn" onclick="setView('pet')" id="btn-view-pet">üè†
            <span class="coin-badge" id="coin-display">0</span>
        </button>
        <div style="width:1px; background:rgba(127,127,127,0.3); height:24px; align-self:center; margin:0 4px;"></div>
        <button class="dock-btn" onclick="setMode('snow')" id="btn-snow">‚ùÑÔ∏è</button>
        <button class="dock-btn" onclick="setMode('spring')" id="btn-spring">üå∏</button>
        <button class="dock-btn" onclick="setMode('rain')" id="btn-rain">üåßÔ∏è</button>
        <div style="width:1px; background:rgba(127,127,127,0.3); height:24px; align-self:center; margin:0 4px;"></div>
        <button class="dock-btn" onclick="toggleGarland()" id="btn-garland">‚ú®</button>
        <button class="dock-btn" onclick="toggleDark()" id="btn-dark">üåó</button>
    </div>

    <div class="garland-wrap" id="garland"></div>

    <div class="app-layout">
        <header>
            <h1 id="header-title">–ú–æ—è –ª—é–±–∏–º–∞—è –ë–∏–±–∞</h1>
            <div class="subtitle">–ë—É–±–∞ —Å—á–∏—Ç–∞–µ—Ç –¥–Ω–∏ –¥–æ –≤—Å—Ç—Ä–µ—á–∏</div>
        </header>

        <!-- VIEW: CALENDAR -->
        <div id="view-calendar" class="view-section active-view">
            <div class="glass-panel">
                <div class="flight-header">
                    <div><div class="city-code">UFA</div><div class="city-name">–£—Ñ–∞</div></div>
                    <div><div class="city-code">MOW</div><div class="city-name">–ú–æ—Å–∫–≤–∞</div></div>
                </div>
                <div id="flight-viz">
                    <svg width="100%" height="100%" style="overflow:visible;">
                        <path id="path-bg" class="track-path" d="" />
                        <path id="path-active" class="active-path" d="" />
                    </svg>
                    <div id="plane-wrapper" onclick="doBarrelRoll()">
                        <div class="pct-pill" id="rt-percent">0.00000%</div>
                        <div class="plane-emoji" id="plane-icon">‚úàÔ∏è</div>
                    </div>
                </div>
                <div class="countdown" id="timer">...</div>
                <div class="timer-caption">–æ—Å—Ç–∞–ª–æ—Å—å –¥–æ –Ω–∞—à–µ–≥–æ –æ—Ç–ø—É—Å–∫–∞</div>
                <div class="dates-meta"><span>11 –Ø–Ω–≤</span><span>12 –ú–∞—è</span></div>
            </div>
            <div id="calendar-root"></div>
        </div>

        <!-- VIEW: PET -->
        <div id="view-pet" class="view-section">
            <div class="glass-panel" style="min-height: 500px;">
                <div class="month-title">
                    üíñ –¢–≤–æ–π –õ—é–±–∏–º–∫–∞
                </div>
                <div class="real-clock" id="real-clock">...</div>

                <!-- EXP BAR -->
                <div class="exp-container">
                    <div class="exp-bar"><div class="exp-fill" id="exp-fill"></div></div>
                    <div class="lvl-text" id="lvl-text">–£—Ä–æ–≤–µ–Ω—å 1</div>
                </div>

                <div class="game-info">
                    <span>–ö–ª–∏–∫: <span id="stat-click">1</span> üí∞</span>
                    <span>–ê–≤—Ç–æ: <span id="stat-auto">0</span> üí∞/—Å–µ–∫</span>
                </div>
                <div class="game-info">
                     <span>–°—Ç—Ä–∏–∫: <span class="streak-fire" id="stat-streak">0</span> üî•</span>
                     <span>–ë–∞–ª–∞–Ω—Å: <span style="color:#FFD700" id="stat-balance">0</span> üí∞</span>
                </div>
                
                <div class="pet-stage" id="pet-stage">
                    <div class="weather-badge" id="weather-badge">‚òÄÔ∏è –¢–µ–ø–ª–æ</div>
                    <div class="rent-info-text" id="rent-info">–ê—Ä–µ–Ω–¥–∞ –æ–ø–ª–∞—á–µ–Ω–∞</div>
                    <div class="house-bg" id="house-bg"></div>
                    <div class="pet-thought" id="pet-thought">–ü—Ä–∏–≤–µ—Ç!</div>
                    <div class="buffs-row" id="buffs-row"></div>
                    
                    <div class="sleep-overlay" id="sleep-overlay">
                        <div>
                           <div>–¢—Å—Å! –ü–∏—Ç–æ–º–µ—Ü —Å–ø–∏—Ç üò¥</div>
                           <div style="font-size:12px; opacity:0.7; margin-top:5px;">–≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è...</div>
                        </div>
                    </div>

                    <div class="pet-blob" id="pet-blob" onclick="petClick(event)">
                        <div class="pet-zzz">Zzz...</div>
                        <!-- Accessories -->
                        <div id="pet-acc-root"></div>
                        <div class="pet-face" id="pet-face">üò∫</div>
                    </div>

                    <div class="stat-bars">
                        <div class="stat-col">
                            <span class="stat-icon">üçî</span>
                            <div class="progress-bar"><div class="progress-fill" id="bar-hunger" style="background:#ff9500; width:50%"></div></div>
                            <div class="stat-num" id="txt-hunger">50/100</div>
                        </div>
                        <div class="stat-col">
                            <span class="stat-icon">‚ù§Ô∏è</span>
                            <div class="progress-bar"><div class="progress-fill" id="bar-love" style="background:#ff2d55; width:50%"></div></div>
                            <div class="stat-num" id="txt-love">50/100</div>
                        </div>
                        <div class="stat-col">
                            <span class="stat-icon">‚ö°</span>
                            <div class="progress-bar"><div class="progress-fill" id="bar-energy" style="background:#32ade6; width:50%"></div></div>
                            <div class="stat-num" id="txt-energy">50/100</div>
                        </div>
                        <div class="stat-col">
                            <span class="stat-icon">üõÅ</span>
                            <div class="progress-bar"><div class="progress-fill" id="bar-hygiene" style="background:#5ac8fa; width:50%"></div></div>
                            <div class="stat-num" id="txt-hygiene">50/100</div>
                        </div>
                    </div>
                </div>
                
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <button class="action-btn" style="background:#28cd41; color:#fff; flex:1; padding:12px;" onclick="openTrading()">üìà –¢—Ä–µ–π–¥–∏–Ω–≥</button>
                    <button class="action-btn" style="background:#5ac8fa; color:#fff; flex:1; padding:12px;" onclick="washPet()">üõÅ –£–º—ã—Ç—å</button>
                    <button class="action-btn" style="background:#5856d6; color:#fff; flex:1; padding:12px;" id="btn-sleep" onclick="toggleSleep()">üò¥ –°–ø–∞—Ç—å</button>
                </div>

                <button class="action-btn" id="btn-rent" style="margin-top:10px; background:#ff3b30; display:none;" onclick="payRent()">üè† –û–ø–ª–∞—Ç–∏—Ç—å –ê—Ä–µ–Ω–¥—É</button>

                <div style="display:flex; gap:10px; margin-top:10px;">
                    <button class="action-btn" style="background:#32ade6; color:#fff; flex:1;" onclick="openCasino()">üé∞ –ö–∞–∑–∏–Ω–æ</button>
                    <button class="action-btn" style="background:var(--accent); color:#fff; flex:1;" onclick="openShop()">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Trading View (Improved) -->
    <div id="view-trading">
        <button class="close-trading" onclick="closeTrading()">X</button>
        <button class="help-btn" onclick="toggleTradeHelp()">?</button>
        
        <div class="trade-help-box" id="trade-help">
            <div style="font-weight:700; color:#fff; margin-bottom:5px;">–ü—Ä–∞–≤–∏–ª–∞</div>
            1. –¶–µ–Ω–∞ –º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É.<br>
            2. –ö—Ä–∞—Å–Ω—ã–π = –î–µ—à–µ–≤–æ (–ü–æ–∫—É–ø–∞–π).<br>
            3. –ó–µ–ª–µ–Ω—ã–π = –î–æ—Ä–æ–≥–æ (–ü—Ä–æ–¥–∞–≤–∞–π).<br>
            4. –ë–∞–Ω–∫ –¥–∞–µ—Ç % —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏.
        </div>

        <div class="month-title" style="margin-bottom:10px;">üìà –ë–∏—Ä–∂–∞ –õ—é–±–≤–∏</div>
        
        <div class="trading-card">
            <div style="display:flex; justify-content:space-between; align-items:center">
                 <div style="font-size:12px; font-weight:700; color:#aaa;">–¶–µ–Ω–∞ BibaCoin <span id="trend-arrow" class="trend-icon"></span></div>
                 <div class="trade-val" id="stock-price" style="color:#30d158">100.00</div>
            </div>
            
            <div class="chart-container">
                <canvas id="trade-chart" width="310" height="150"></canvas>
            </div>

            <div class="trade-stat">
                <span>–ü–æ—Ä—Ç—Ñ–µ–ª—å:</span>
                <span style="color:#fff"><span id="stock-owned">0</span> BC</span>
            </div>
            <div class="trade-stat">
                <span>–ú–æ–Ω–µ—Ç—ã:</span>
                <span style="color:#FFD700"><span id="trade-cash">0</span> üí∞</span>
            </div>

            <div class="trade-btns">
                <button class="t-btn t-buy" onclick="tradeBuy()">–ö—É–ø–∏—Ç—å 1</button>
                <button class="t-btn t-sell" onclick="tradeSell()">–ü—Ä–æ–¥–∞—Ç—å 1</button>
            </div>
            
            <div class="bank-section">
                <div style="font-size:12px; font-weight:800; color:#aaa; margin-bottom:5px;">üè¶ –ë–∞–Ω–∫ (–°—Ç–∞–≤–∫–∞ —Å–µ–≥–æ–¥–Ω—è: <span id="bank-rate-disp" style="color:#0a84ff">5%</span>)</div>
                <div style="font-size:10px; color:#666; margin-bottom:10px;">–í –±–∞–Ω–∫–µ: <span id="bank-balance" style="color:#fff">0</span> üí∞</div>
                <div class="bank-row">
                    <input type="number" id="bank-amount" class="bank-input" placeholder="–°—É–º–º–∞">
                    <button class="max-btn" onclick="setMaxBank()">MAX</button>
                </div>
                <div style="display:flex; gap:10px;">
                    <button class="t-btn t-depo" onclick="bankDeposit()">–ü–æ–ª–æ–∂–∏—Ç—å</button>
                    <button class="t-btn t-with" onclick="bankWithdraw()">–°–Ω—è—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Casino View -->
    <div id="view-casino">
        <div class="roulette-table">
            <div style="color:#fff; font-weight:800; font-size:24px; margin-bottom:10px;">üé∞ –†—É–ª–µ—Ç–∫–∞</div>
            <div style="color:#d4af37; margin-bottom:10px;">–ë–∞–ª–∞–Ω—Å: <span id="casino-balance">0</span></div>
            
            <div class="wheel-container">
                <div class="wheel-arrow"></div>
                <div class="wheel" id="roulette-wheel"></div>
            </div>

            <input type="number" id="casino-bet" class="casino-input" placeholder="–°—Ç–∞–≤–∫–∞" min="1">
            
            <div class="roulette-opts">
                <button class="r-btn r-red" onclick="spinRoulette('red')">üî¥ x2</button>
                <button class="r-btn r-green" onclick="spinRoulette('green')">üü¢ x14</button>
                <button class="r-btn r-black" onclick="spinRoulette('black')">‚ö´ x2</button>
            </div>
        </div>
        <button class="action-btn" style="margin-top:20px; background:rgba(255,255,255,0.2); width:auto; padding:10px 30px;" onclick="document.getElementById('view-casino').classList.remove('active')">–í—ã—Ö–æ–¥</button>
    </div>

    <!-- Notification -->
    <div class="toast-pill" id="toast"><span>üîí</span> <span id="toast-text">...</span></div>

    <!-- Modal -->
    <div class="modal-layer" id="modal">
        <div class="letter-box">
            <div style="font-size: 50px; margin-bottom: 10px;">üíå</div>
            <div style="font-size: 11px; font-weight: 800; opacity: 0.4; text-transform: uppercase;" id="m-date">...</div>
            <div class="quote-text" id="m-text">...</div>
            <div style="font-weight: 700; color: var(--accent); margin-bottom: 30px;" id="m-source">...</div>
            <button class="action-btn" onclick="closeModal()">–õ—é–±–ª—é —Ç–µ–±—è, –ë—É–±–∞ ‚ù§Ô∏è</button>
        </div>
    </div>

    <!-- Shop Modal -->
    <div class="shop-modal" id="shop-modal">
        <div class="glass-panel" style="background: var(--card-light); width: 100%; max-width: 350px;">
            <div class="month-title">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω <span style="margin-left:auto; font-size:14px;">üí∞ <span id="shop-coins">0</span></span></div>
            <div class="shop-tabs">
                <div class="shop-tab active" onclick="switchShop('food')">üçî –ï–¥–∞</div>
                <div class="shop-tab" onclick="switchShop('wear')">üëó –û–¥–µ–∂–¥–∞</div>
                <div class="shop-tab" onclick="switchShop('house')">üè† –ñ–∏–ª—å–µ</div>
                <div class="shop-tab" onclick="switchShop('gadget')">ü§ñ –ì–∞–¥–∂–µ—Ç—ã</div>
                <div class="shop-tab" onclick="switchShop('buff')">‚ú® –ó–µ–ª—å—è</div>
                <div class="shop-tab" onclick="switchShop('upgrade')">‚ö° –ù–∞–≤—ã–∫–∏</div>
            </div>
            <div class="shop-grid" id="shop-list"></div>
            <button class="action-btn" style="margin-top:20px;" onclick="closeShop()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
        // === DATA ===
        const START = new Date(2026, 0, 11);
        const END = new Date(2026, 4, 12);
        const DATA_KEY = 'love_cal_v3_final_r1';
        const SETTINGS_KEY = 'love_cal_settings_v3_r1';
        const PET_KEY = 'love_cal_pet_v3_final_r2'; // Version bump for reset/balance

        const WEEKDAYS = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
        const HOLIDAYS = { '1-14': 'üíò', '1-23': '‚≠ê', '2-8': 'üå∑', '4-1': 'üéà', '4-9': 'üéñÔ∏è' };
        
        const quotes = [
            {t: "–ú–æ—è –º–∏–ª–∞—è –ë–∏–±–∞, –º—ã —Å —Ç–æ–±–æ–π –æ–¥–Ω–æ–π –∫—Ä–æ–≤–∏, —Ç—ã –∏ —è.", s: "–¢–≤–æ–π –ë—É–±–∞"},
            {t: "–û–ª—è, –∑–Ω–∞–µ—à—å, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –ú–æ–ª–Ω–∏—è –ú–∞–∫–∫—É–∏–Ω? ¬´–ö—á–∞—É!¬ª", s: "–¢–∞—á–∫–∏ & –ë—É–±–∞"},
            {t: "–Ø –Ω–µ —Ö–æ—á—É –±—ã—Ç—å —á–µ–ª–æ–≤–µ–∫–æ–º, —è —Ö–æ—á—É –±—ã—Ç—å —Å —Ç–æ–±–æ–π!", s: "–ß–µ–±—É—Ä–∞—à–∫–∞"},
            {t: "–ë–∏–±–∞, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –∑–Ω–∞—á–∏—Ç —Ç–∞–∫ –º–∞–ª–æ, –∫–æ–≥–¥–∞ —Ç—ã –∑–Ω–∞—á–∏—à—å —Ç–∞–∫ –º–Ω–æ–≥–æ.", s: "–ò—Å–∫—Ä–µ–Ω–Ω–µ"},
            {t: "–û—Ö–∞–Ω–∞ ‚Äî –∑–Ω–∞—á–∏—Ç —Å–µ–º—å—è. –ê —Å–µ–º—å—è ‚Äî —ç—Ç–æ –º—ã —Å —Ç–æ–±–æ–π.", s: "–õ–∏–ª–æ –∏ –°—Ç–∏—á"},
            {t: "–£–ª—ã–±–∞–µ–º—Å—è –∏ –º–∞—à–µ–º, –ë–∏–±–∞! –£–ª—ã–±–∞–µ–º—Å—è –∏ –º–∞—à–µ–º!", s: "–ú–∞–¥–∞–≥–∞—Å–∫–∞—Ä"},
            {t: "–û–ª–µ–Ω—å–∫–∞, —Ç—ã –∫—Ä–∞—Å–∏–≤–∞, –∫–∞–∫ —Å–∞–º—ã–π —è—Ä–∫–∏–π –º–∞–π—Å–∫–∏–π —Ä–∞—Å—Å–≤–µ—Ç.", s: "–¢–≤–æ–π –≤–ª—é–±–ª–µ–Ω–Ω—ã–π"},
            {t: "–Ø –ª—é–±–ª—é —Ç–µ–±—è –±–æ–ª—å—à–µ, —á–µ–º –≤—á–µ—Ä–∞, –Ω–æ –º–µ–Ω—å—à–µ, —á–µ–º –∑–∞–≤—Ç—Ä–∞.", s: "–ù–∞–≤—Å–µ–≥–¥–∞"},
            {t: "–ú—ã —Å—Ç—Ä–æ–∏–ª–∏, —Å—Ç—Ä–æ–∏–ª–∏ –∏ –Ω–∞–∫–æ–Ω–µ—Ü... –ø–æ—Å—Ç—Ä–æ–∏–º –Ω–∞—à–µ —Å—á–∞—Å—Ç—å–µ!", s: "–ú—É–¥—Ä–æ—Å—Ç—å"},
            {t: "–¢—ã ‚Äî –ø—Ä–∏—á–∏–Ω–∞ –º–æ–µ–π —É–ª—ã–±–∫–∏ —Å–µ–≥–æ–¥–Ω—è, –ë–∏–±–∞.", s: "–ë—É–±–∞"},
            {t: "–ñ–¥–∞—Ç—å —Ç—è–∂–µ–ª–æ, –º–æ—è —Ö–æ—Ä–æ—à–∞—è, —è –∑–Ω–∞—é. –ù–æ –Ω–∞–≥—Ä–∞–¥–∞ ‚Äî —ç—Ç–æ —Ç—ã.", s: "–û –≥–ª–∞–≤–Ω–æ–º"},
            {t: "–ë–∏–±–∞, —Ç—ã –º–æ–π –ª—É—á—à–∏–π –¥—Ä—É–≥, –º–æ—è –ª—é–±–æ–≤—å –∏ –º–æ—è –≤—Å–µ–ª–µ–Ω–Ω–∞—è.", s: "–ü—Ä–∏–∑–Ω–∞–Ω–∏–µ"},
            {t: "–í –º–æ–µ–º —Å–µ—Ä–¥—Ü–µ –≤—Å–µ–≥–¥–∞ –≤–µ—Å–Ω–∞, –∫–æ–≥–¥–∞ —è –¥—É–º–∞—é –æ —Ç–µ–±–µ, –û–ª—è.", s: "–ß—É–≤—Å—Ç–≤–∞"},
            {t: "–Ø —Å–∫—É—á–∞—é –ø–æ —Ç–µ–±–µ 3000.", s: "–ú—Å—Ç–∏—Ç–µ–ª–∏"},
            {t: "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî —ç—Ç–æ —à–∞–≥ –Ω–∞–≤—Å—Ç—Ä–µ—á—É.", s: "–ú–æ—Ç–∏–≤–∞—Ü–∏—è"},
            {t: "–¢—ã –¥–µ–ª–∞–µ—à—å –º–µ–Ω—è —Å–∏–ª—å–Ω–µ–µ, –ë–∏–±–∞.", s: "–¢–≤–æ—è –æ–ø–æ—Ä–∞"},
            {t: "–Ø —Å —Ç–æ–±–æ–π. –í—Å–µ–≥–¥–∞. –î–∞–∂–µ –µ—Å–ª–∏ —Ç—ã –º–µ–Ω—è –Ω–µ –≤–∏–¥–∏—à—å.", s: "–ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä"},
            {t: "–¢—ã ‚Äî –º–æ–π –æ–∫–µ–∞–Ω, –û–ª—è.", s: "–†–æ–º–∞–Ω—Ç–∏–∫–∞"},
            {t: "–°–∫–æ—Ä–æ –º—ã –±—É–¥–µ–º –ø–∏—Ç—å –∫–æ—Ñ–µ –≤–º–µ—Å—Ç–µ.", s: "–ú–µ—á—Ç–∞"},
            {t: "–û–±–Ω–∏–º–∞—é —Ç–µ–±—è –∫—Ä–µ–ø–∫–æ-–∫—Ä–µ–ø–∫–æ.", s: "–î–µ–π—Å—Ç–≤–∏–µ"},
            {t: "–¢—ã ‚Äî –º–æ–µ —Å–æ–ª–Ω—ã—à–∫–æ.", s: "–¢–µ–ª–µ–ø—É–∑–∏–∫–∏"},
            {t: "–ù–∞—à–∞ –≤—Å—Ç—Ä–µ—á–∞ –Ω–µ–∏–∑–±–µ–∂–Ω–∞, –∫–∞–∫ —Ä–∞—Å—Å–≤–µ—Ç.", s: "–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å"},
            {t: "–Ø –±–µ—Ä–µ–≥—É —Ç–µ–±—è –≤ —Å–∞–º–æ–º –Ω–∞–¥–µ–∂–Ω–æ–º —Å–µ–π—Ñ–µ ‚Äî –≤ —Å–≤–æ–µ–º —Å–µ—Ä–¥—Ü–µ.", s: "–°–µ–∫—Ä–µ—Ç"},
            {t: "–¢—ã —Å–∞–º–∞—è-—Å–∞–º–∞—è –ª—É—á—à–∞—è –¥–µ–≤–æ—á–∫–∞ –Ω–∞ —Å–≤–µ—Ç–µ.", s: "–§–∞–∫—Ç"},
            {t: "–ó–Ω–∞–µ—à—å, –¥–∞–∂–µ –®—Ä–µ–∫ –Ω–µ —Ç–∞–∫ –ª—é–±–∏–ª –§–∏–æ–Ω—É —á–µ—Ä–µ–∑ –±–æ–ª–æ—Ç–∞.", s: "–®—Ä–µ–∫"},
            {t: "–ú–æ–π –º–∏—Ä –±–µ–∑ —Ç–µ–±—è —á–µ—Ä–Ω–æ-–±–µ–ª—ã–π, –ë–∏–±–∞.", s: "–¶–≤–µ—Ç"},
            {t: "–°–∫–æ—Ä–æ –≤—Å–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è. –ú—ã –ø—Ä–æ—Å–Ω–µ–º—Å—è –≤ –æ–¥–Ω–æ–π –∫—Ä–æ–≤–∞—Ç–∏.", s: "–ù–∞–¥–µ–∂–¥–∞"},
            {t: "–ë–∏–±–∞, —Ç—ã –º–æ–π —à—Ç—É—Ä–º–∞–Ω.", s: "–¢–∞—á–∫–∏"},
            {t: "–õ—é–±–æ–≤—å ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Å—á–∞—Å—Ç—å–µ –¥—Ä—É–≥–æ–≥–æ –≤–∞–∂–Ω–µ–µ —Ç–≤–æ–µ–≥–æ.", s: "–•–æ–ª–æ–¥–Ω–æ–µ —Å–µ—Ä–¥—Ü–µ"},
            {t: "–°–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ –Ω–µ —Å–ª—É—á–∞–π–Ω—ã. –¢–æ, —á—Ç–æ –º—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏—Å—å ‚Äî –ª—É—á—à–∏–π –ø–æ–¥–∞—Ä–æ–∫.", s: "–ö—É–Ω–≥-—Ñ—É –ü–∞–Ω–¥–∞"},
            {t: "–Ø —Å–º–æ—Ç—Ä—é –Ω–∞ —Ç–≤–æ–µ —Ñ–æ—Ç–æ –∏ –ø–æ–Ω–∏–º–∞—é: —Ä–∞–¥–∏ —ç—Ç–∏—Ö –≥–ª–∞–∑ —è –≥–æ—Ç–æ–≤ –Ω–∞ –≤—Å–µ.", s: "–ë—É–±–∞"},
            {t: "–¢—ã ‚Äî –º–æ–π –ª–∏—á–Ω—ã–π —Å–æ—Ä—Ç –≥–µ—Ä–æ–∏–Ω–∞.", s: "–°—É–º–µ—Ä–∫–∏"},
            {t: "–ï—Å–ª–∏ –±—ã –º–Ω–µ –¥–∞–≤–∞–ª–∏ –º–æ–Ω–µ—Ç—É –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ —è –¥—É–º–∞—é –æ —Ç–µ–±–µ, —è –±—ã –±—ã–ª –±–æ–≥–∞—Ç.", s: "–ë–æ–≥–∞—Ç—Å—Ç–≤–æ"},
            {t: "–¢—ã ‚Äî —á—É–¥–æ. –ú–æ–µ –ª–∏—á–Ω–æ–µ –Ω–æ–≤–æ–≥–æ–¥–Ω–µ–µ —á—É–¥–æ.", s: "–í–æ–ª—à–µ–±—Å—Ç–≤–æ"},
            {t: "–Ø –ª—é–±–ª—é, –∫–æ–≥–¥–∞ –º–µ–Ω—è –æ–±–æ–∂–∞—é—Ç! –ê —è –æ–±–æ–∂–∞—é —Ç–µ–±—è.", s: "–ú–∞–¥–∞–≥–∞—Å–∫–∞—Ä"},
            {t: "–Ø —Å—á–∏—Ç–∞—é –¥–Ω–∏, —á–∞—Å—ã –∏ –º–∏–Ω—É—Ç—ã.", s: "–í—Ä–µ–º—è"},
            {t: "–¢—ã —Å–Ω–∏—à—å—Å—è –º–Ω–µ –∫–∞–∂–¥—É—é –Ω–æ—á—å.", s: "–°–Ω—ã"},
            {t: "–û–ª—è, —Ç–≤–æ—è —É–ª—ã–±–∫–∞ –æ—Å–≤–µ—â–∞–µ—Ç –º–Ω–µ –ø—É—Ç—å.", s: "–¢–∞—á–∫–∏"},
            {t: "–Ø —Ä—è–¥–æ–º. –ü—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä–æ–π –≥–ª–∞–∑–∞.", s: "–ú–∞–≥–∏—è"},
            {t: "–¢—ã –¥–µ–ª–∞–µ—à—å –º–µ–Ω—è –ª—É—á—à–µ.", s: "–í–ª–∏—è–Ω–∏–µ"},
            {t: "–°–∫–æ—Ä–æ –≤–µ—Å–Ω–∞, –ë–∏–±–∞! –ê –≤–µ—Å–Ω–∞ ‚Äî —ç—Ç–æ –∂–∏–∑–Ω—å.", s: "–ö–∞–ª–µ–Ω–¥–∞—Ä—å"},
            {t: "–Ø –ª—é–±–ª—é, –∫–æ–≥–¥–∞ —Ç—ã –º–µ–Ω—è –Ω–∞–∑—ã–≤–∞–µ—à—å –ë—É–±–æ–π.", s: "–ü—Ä–∏–∑–Ω–∞–Ω–∏–µ"},
            {t: "–ú—ã —Å —Ç–æ–±–æ–π –∫–∞–∫ –ú—ç—Ç—Ä –∏ –ú–∞–∫–∫—É–∏–Ω.", s: "–¢–∞—á–∫–∏"},
            {t: "–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ç–µ—Å—Ç.", s: "–£—á–µ–±–∞"},
            {t: "–ú–Ω–µ –Ω–µ –Ω—É–∂–Ω—ã –ø–æ–¥–∞—Ä–∫–∏, –º–Ω–µ –Ω—É–∂–Ω–∞ —Ç—ã.", s: "–ü—Ä–∞–∑–¥–Ω–∏–∫"},
            {t: "–Ø –ª—é–±–ª—é –∫–∞–∂–¥—É—é —Ç–≤–æ—é —á–µ—Ä—Ç–æ—á–∫—É.", s: "–î–µ—Ç–∞–ª–∏"},
            {t: "–¢—ã ‚Äî –º–æ–π –¥–æ–º, –û–ª—è.", s: "–£—é—Ç"},
            {t: "–ï—â–µ –æ–¥–∏–Ω –¥–µ–Ω—å –∑–∞—á–µ—Ä–∫–Ω—É—Ç.", s: "–ü–æ–±–µ–¥–∞"},
            {t: "–ú–∞—Ä—Ç! –ö–æ—Ç—ã –ø–æ—é—Ç, –∞ –º–æ–µ —Å–µ—Ä–¥—Ü–µ –ø–æ–µ—Ç —Ç–≤–æ–µ –∏–º—è.", s: "–í–µ—Å–Ω–∞"},
            {t: "–¢—ã —Ä–∞—Å—Ü–≤–µ—Ç–∞–µ—à—å, –∫–∞–∫ —Å–∞–º—ã–π –∫—Ä–∞—Å–∏–≤—ã–π —Ü–≤–µ—Ç–æ–∫.", s: "–°–∞–¥–æ–≤–Ω–∏–∫"},
            {t: "–Ø —Å–∫—É—á–∞—é –ø–æ —Ç–≤–æ–∏–º —Ä—É–∫–∞–º.", s: "–¢–µ–ø–ª–æ"},
            {t: "–ë–∏–±–∞, —Ç—ã ‚Äî –º–æ—è –±–∞—Ç–∞—Ä–µ–π–∫–∞.", s: "–≠–Ω–µ—Ä–≥–∏—è"},
            {t: "–°–∫–æ—Ä–æ –ª–µ–¥ —Ä–∞—Å—Ç–∞–µ—Ç, –∏ –º—ã –≤—Å—Ç—Ä–µ—Ç–∏–º—Å—è.", s: "–ü—Ä–æ–≥–Ω–æ–∑"},
            {t: "–¢—ã ‚Äî –º–æ–µ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ.", s: "–†–∞–±–æ—Ç–∞"},
            {t: "–Ø –ª—é–±–ª—é —Ç–µ–±—è –¥–æ –õ—É–Ω—ã –∏ –æ–±—Ä–∞—Ç–Ω–æ.", s: "–ö–æ—Å–º–æ—Å"},
            {t: "–¢—ã ‚Äî –º–æ—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è.", s: "–ò—Å—Ç–∏–Ω–∞"},
            {t: "–°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ!", s: "–í–≤–µ—Ä—Ö"},
            {t: "–ë–∏–±–∞, –Ω–µ –≥—Ä—É—Å—Ç–∏. –¢–≤–æ–π –ë—É–±–∞ —Å–∫–æ—Ä–æ –ø—Ä–∏–µ–¥–µ—Ç.", s: "–û–±–µ—â–∞–Ω–∏–µ"},
            {t: "–¢–≤–æ–∏ –≥–ª–∞–∑–∞ ‚Äî –∫–∞–∫ –¥–≤–∞ –æ–∫–µ–∞–Ω–∞.", s: "–í–∑–≥–ª—è–¥"},
            {t: "–Ø –≥–æ—Ä–∂—É—Å—å —Ç–æ–±–æ–π, –û–ª—è.", s: "–ì–æ—Ä–¥–æ—Å—Ç—å"},
            {t: "–ú—ã —Å–ø—Ä–∞–≤–∏–º—Å—è. –ú—ã –∂–µ –±–∞–Ω–¥–∞!", s: "–ö–æ–º–∞–Ω–¥–∞"},
            {t: "–õ—é–±–æ–≤—å ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –Ω–µ –º–æ–∂–µ—à—å —É—Å–Ω—É—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –ª—É—á—à–µ —Å–Ω–æ–≤.", s: "–ö–ª–∞—Å—Å–∏–∫–∞"},
            {t: "–¢—ã ‚Äî –º–æ—è –∑–≤–µ–∑–¥–æ—á–∫–∞.", s: "–ù–æ—á—å"},
            {t: "–Ø —Ö–æ—á—É –≥–æ—Ç–æ–≤–∏—Ç—å —Ç–µ–±–µ –∑–∞–≤—Ç—Ä–∞–∫–∏.", s: "–ó–∞–±–æ—Ç–∞"},
            {t: "–ö–∞–∂–¥–∞—è –ø–µ—Å–Ω—è –æ –ª—é–±–≤–∏ —Ç–µ–ø–µ—Ä—å –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –º–Ω–µ –æ —Ç–µ–±–µ.", s: "–ú—É–∑—ã–∫–∞"},
            {t: "–¢—ã ‚Äî –º–æ–π —Å–∞–º—ã–π —Å–ª–∞–¥–∫–∏–π –ø–æ–Ω—á–∏–∫.", s: "–í–∫—É—Å–Ω–æ"},
            {t: "–Ø –ª—é–±–ª—é —Ç–µ–±—è, –ë–∏–±–∞. –ü—Ä–æ—Å—Ç–æ, —Å–∏–ª—å–Ω–æ –∏ –Ω–∞–≤—Å–µ–≥–¥–∞.", s: "–ü—Ä–æ—Å—Ç–æ"},
            {t: "–°–∫–æ—Ä–æ –∞–ø—Ä–µ–ª—å. –≠—Ç–æ —É–∂–µ —Ñ–∏–Ω–∏—à–Ω–∞—è –ø—Ä—è–º–∞—è!", s: "–í—Ä–µ–º—è"},
            {t: "–Ø –≤–µ—Ä—é –≤ –Ω–∞—Å.", s: "–í–µ—Ä–∞"},
            {t: "–¢—ã ‚Äî –º–∞–≥–∏—è –≤–Ω–µ –•–æ–≥–≤–∞—Ä—Ç—Å–∞.", s: "–ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä"},
            {t: "–ú–æ–µ —Å–µ—Ä–¥—Ü–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Ç–µ–±–µ.", s: "–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å"},
            {t: "–ñ–¥—É –º–æ–º–µ–Ω—Ç–∞, –∫–æ–≥–¥–∞ —É–≤–∏–∂—É —Ç–µ–±—è.", s: "–í—Å—Ç—Ä–µ—á–∞"},
            {t: "–¢—ã ‚Äî –º–æ—è —Ä–∞–¥–æ—Å—Ç—å.", s: "–≠–º–æ—Ü–∏–∏"},
            {t: "–Ø —Å–∫—É—á–∞—é –ø–æ —Ç–≤–æ–µ–º—É –≥–æ–ª–æ—Å—É.", s: "–°–≤—è–∑—å"},
            {t: "–ú—ã —Å —Ç–æ–±–æ–π –∫–∞–∫ –ø–∞–∑–ª.", s: "–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ"},
            {t: "–õ—é–±–∏—Ç—å —Ç–µ–±—è ‚Äî —ç—Ç–æ —Å–∞–º–æ–µ –ª–µ–≥–∫–æ–µ –¥–µ–ª–æ.", s: "–ß—É–≤—Å—Ç–≤–∞"},
            {t: "–¢—ã ‚Äî –º–æ–µ –≤—Å–µ, –û–ª—è.", s: "–ò—Ç–æ–≥"},
            {t: "–ê–ø—Ä–µ–ª—å! –ë–∏–±–∞, —Å–º–æ—Ç—Ä–∏, –º–∞–π —É–∂–µ –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–µ!", s: "–ö–∞–ª–µ–Ω–¥–∞—Ä—å"},
            {t: "–ï—â–µ —á—É—Ç—å-—á—É—Ç—å, –º–æ—è —Ö–æ—Ä–æ—à–∞—è.", s: "–¢–µ—Ä–ø–µ–Ω–∏–µ"},
            {t: "–Ø —É–∂–µ –ø–ª–∞–Ω–∏—Ä—É—é, –∫—É–¥–∞ –º—ã –ø–æ–π–¥–µ–º.", s: "–ü–ª–∞–Ω—ã"},
            {t: "–¢—ã —á—É–≤—Å—Ç–≤—É–µ—à—å? –í–æ–∑–¥—É—Ö –ø–∞—Ö–Ω–µ—Ç –Ω–∞—à–µ–π –≤—Å—Ç—Ä–µ—á–µ–π.", s: "–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞"},
            {t: "–Ø –ª—é–±–ª—é —Ç–µ–±—è —Å–∏–ª—å–Ω–µ–µ, —á–µ–º –≤—á–µ—Ä–∞.", s: "–ü—Ä–æ–≥—Ä–µ—Å—Å–∏—è"},
            {t: "–¢—ã ‚Äî –º–æ—è –≤–µ—Å–Ω–∞.", s: "–ú–µ—Ç–∞—Ñ–æ—Ä–∞"},
            {t: "–°–∫–æ—Ä–æ—Å—Ç—å! –Ø —Å–∫–æ—Ä–æ—Å—Ç—å! –í—Ä–µ–º—è, –ª–µ—Ç–∏ –±—ã—Å—Ç—Ä–µ–µ!", s: "–¢–∞—á–∫–∏"},
            {t: "–î–∂—É–ª–∏–∞–Ω –±—ã —Å–∫–∞–∑–∞–ª: ¬´–ö–∞–∫–∞—è –∂–µ–Ω—â–∏–Ω–∞!¬ª", s: "–ú–∞–¥–∞–≥–∞—Å–∫–∞—Ä"},
            {t: "–¢—ã —Å–∞–º–∞—è –∫—Ä–∞—Å–∏–≤–∞—è –¥–µ–≤—É—à–∫–∞ –≤ –º–∏—Ä–µ.", s: "–ö–æ–º–ø–ª–∏–º–µ–Ω—Ç"},
            {t: "–Ø —Å—á–∏—Ç–∞—é –¥–∞–∂–µ —Å–µ–∫—É–Ω–¥—ã.", s: "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"},
            {t: "–¢—ã –¥–µ–ª–∞–µ—à—å —ç—Ç–æ—Ç –º–∏—Ä –¥–æ–±—Ä—ã–º.", s: "–î–æ–±—Ä–æ"},
            {t: "–Ø —Ö–æ—á—É –≥—É–ª—è—Ç—å —Å —Ç–æ–±–æ–π –ø–æ–¥ –¥–æ–∂–¥–µ–º.", s: "–†–æ–º–∞–Ω—Ç–∏–∫–∞"},
            {t: "–¢—ã ‚Äî –º–æ–π –ª—É—á—à–∏–π –ø–æ–¥–∞—Ä–æ–∫.", s: "–ü—Ä–∞–∑–¥–Ω–∏–∫"},
            {t: "–°–∫–æ—Ä–æ –≤—Å–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è. –ú—ã –±—É–¥–µ–º —Ä—è–¥–æ–º.", s: "–ë—É–¥—É—â–µ–µ"},
            {t: "–¢—ã ‚Äî –º–æ—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ë–∏–±–∞.", s: "–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å"},
            {t: "–î–∞–≤–∞–π –Ω–∏–∫–æ–≥–¥–∞ –±–æ–ª—å—à–µ –Ω–µ —Ä–∞—Å—Å—Ç–∞–≤–∞—Ç—å—Å—è —Ç–∞–∫ –Ω–∞–¥–æ–ª–≥–æ.", s: "–£–≥–æ–≤–æ—Ä"},
            {t: "–¢—ã –º–Ω–µ —Å–Ω–∏—à—å—Å—è.", s: "–°–æ–Ω"},
            {t: "–õ—é–±–æ–≤—å ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –Ω–µ –Ω—É–∂–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç—å ¬´–ø—Ä–æ—Å—Ç–∏¬ª.", s: "–ò—Å—Ç–æ—Ä–∏—è"},
            {t: "–Ø –≤—Å–µ–≥–¥–∞ –±—É–¥—É –∏—Å–∫–∞—Ç—å —Ç–µ–±—è –≤ —Ç–æ–ª–ø–µ.", s: "–û—Ä–∏–µ–Ω—Ç–∏—Ä"},
            {t: "–¢–≤–æ—è —É–ª—ã–±–∫–∞ ‚Äî –º–æ–µ —Å–æ–ª–Ω—Ü–µ.", s: "–°–≤–µ—Ç"},
            {t: "–Ø –±–µ—Ä–µ–≥—É –∫–∞–∂–¥–æ–µ —Ç–≤–æ–µ —Å–ª–æ–≤–æ.", s: "–¶–µ–Ω–Ω–æ—Å—Ç—å"},
            {t: "–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ —É—á–∏—Ç —Ü–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è.", s: "–£—Ä–æ–∫"},
            {t: "–¢—ã ‚Äî –º–æ–π –∫–æ–º–ø–∞—Å, –û–ª—è.", s: "–ù–∞–≤–∏–≥–∞—Ü–∏—è"},
            {t: "–Ø –ª—é–±–ª—é —Ç–µ–±—è –¥–æ –≥–ª—É–±–∏–Ω—ã –¥—É—à–∏.", s: "–ì–ª—É–±–∏–Ω–∞"},
            {t: "–¢—ã ‚Äî –º–æ–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ.", s: "–î–∑–µ–Ω"},
            {t: "–ï—â–µ –∫–∞–ø–µ–ª—å–∫—É...", s: "–§–∏–Ω–∞–ª"},
            {t: "–Ø —É–∂–µ —Å–æ–±–∏—Ä–∞—é —á–µ–º–æ–¥–∞–Ω –≤ –º—ã—Å–ª—è—Ö.", s: "–°–±–æ—Ä—ã"},
            {t: "–¢—ã –¥–∞–∂–µ –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—à—å, –∫–∞–∫ —è —Å–æ—Å–∫—É—á–∏–ª—Å—è.", s: "–¢–æ—Å–∫–∞"},
            {t: "–ú–∞–π —É–∂–µ —Å—Ç—É—á–∏—Ç—Å—è –≤ –¥–≤–µ—Ä—å!", s: "–†–∞–¥–æ—Å—Ç—å"},
            {t: "–ú–ê–ô! –ë–∏–±–∞, –º—ã –¥–æ–∂–∏–ª–∏! –£—Ä–∞!", s: "–ü–æ–±–µ–¥–∞"},
            {t: "–û—Å—Ç–∞–ª–∏—Å—å —Å—á–∏—Ç–∞–Ω–Ω—ã–µ –¥–Ω–∏.", s: "–ü—É–ª—å—Å"},
            {t: "–Ø —É–∂–µ —á—É–≤—Å—Ç–≤—É—é —Ç–≤–æ–∏ –¥—É—Ö–∏.", s: "–û–±–æ–Ω—è–Ω–∏–µ"},
            {t: "–ì–æ—Ç–æ–≤—å—Å—è –∫ —Å–∞–º—ã–º –∫—Ä–µ–ø–∫–∏–º –æ–±–Ω–∏–º–∞—à–∫–∞–º.", s: "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"},
            {t: "–°–∫–æ—Ä–æ —è —É–≤–∏–∂—É —Ç–≤–æ–∏ –≥–ª–∞–∑–∞ –≤–∂–∏–≤—É—é.", s: "–°—á–∞—Å—Ç—å–µ"},
            {t: "–≠—Ç–æ –±—ã–ª–æ –¥–æ–ª–≥–æ, –Ω–æ –º—ã —Å–º–æ–≥–ª–∏.", s: "–ì–æ—Ä–¥–æ—Å—Ç—å"},
            {t: "–Ø –ª—é–±–ª—é —Ç–µ–±—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, –º–æ—è –û–ª—è.", s: "–ö–æ—Å–º–æ—Å"},
            {t: "–ß–µ–º–æ–¥–∞–Ω —Å–æ–±—Ä–∞–Ω. –ë–∏–ª–µ—Ç –≤ –∫–∞—Ä–º–∞–Ω–µ.", s: "–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å"},
            {t: "–ñ–¥–∏ –º–µ–Ω—è, –∏ —è –≤–µ—Ä–Ω—É—Å—å.", s: "–ö–ª–∞—Å—Å–∏–∫–∞"},
            {t: "–ö—á–∞—É! –Ø –µ–¥—É –∫ —Ç–µ–±–µ!", s: "–¢–∞—á–∫–∏"},
            {t: "–ó–∞–≤—Ç—Ä–∞ –∏–ª–∏ –ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞? –£–∂–µ –Ω–µ–≤–∞–∂–Ω–æ!", s: "–ë–ª–∏–∑–æ—Å—Ç—å"},
            {t: "–ë–ò–ë–ê! –Ø –¢–£–¢! –û–¢–ü–£–°–ö! –ë–£–ë–ê –ü–†–ò–ï–•–ê–õ!", s: "12 –ú–ê–Ø"}
        ];

        let state = {
            opened: JSON.parse(localStorage.getItem(DATA_KEY)) || {},
            settings: { mode: 'snow', garland: false, dark: false },
            pet: JSON.parse(localStorage.getItem(PET_KEY)) || {
                coins: 0, 
                clickLevel: 1, 
                autoLevel: 0,
                hunger: 80, love: 80, energy: 100, hygiene: 100,
                lastLogin: 0, streak: 0,
                wear: null, house: null, inventory: [],
                exp: 0, maxExp: 100, level: 1,
                activeBuffs: [], gadgets: { feeder: 0, sleeper: 0, heater: 0, ac: 0 },
                rentPaidMonth: -1, isSleeping: false,
                stocks: 0, stockBank: 0, bankRate: 5,
                outfit: { head:null, eyes:null, neck:null, body:null },
                lastDecay: Date.now()
            }
        };
        // Migration
        if(state.pet.outfit === undefined) { state.pet.outfit = { head:null, eyes:null, neck:null, body:null }; if(state.pet.wear && state.pet.wear.pos) state.pet.outfit[state.pet.wear.pos] = state.pet.wear; state.pet.wear = null; }
        if(state.pet.bankRate === undefined) state.pet.bankRate = 5;
        if(state.pet.lastDecay === undefined) state.pet.lastDecay = Date.now();

        // BALANCED FORMULAS V17 (Long term engagement)
        const getClickPower = () => Math.floor(1 * Math.pow(1.2, state.pet.clickLevel));
        const getAutoIncome = () => state.pet.autoLevel === 0 ? 0 : Math.floor(1 * Math.pow(1.15, state.pet.autoLevel));
        
        // EXPONENTIAL COST GROWTH
        const getClickUpgradeCost = () => Math.floor(100 * Math.pow(1.6, state.pet.clickLevel));
        const getAutoUpgradeCost = () => Math.floor(200 * Math.pow(1.6, state.pet.autoLevel));

        // --- SHOP DATA ---
        const SHOP = {
            food: [
                {id:'f1',name:'–ö–æ–Ω—Ñ–µ—Ç–∫–∞',ico:'üç¨',cost:5,effect:'h+5'},
                {id:'f2',name:'–Ø–±–ª–æ–∫–æ',ico:'üçé',cost:15,effect:'h+10'},
                {id:'f3',name:'–ë–∞–Ω–∞–Ω',ico:'üçå',cost:20,effect:'h+12'},
                {id:'f4',name:'–ö—Ä—É–∞—Å—Å–∞–Ω',ico:'ü•ê',cost:50,effect:'h+20'},
                {id:'f5',name:'–Ø–∏—á–Ω–∏—Ü–∞',ico:'üç≥',cost:100,effect:'h+30'},
                {id:'f6',name:'–ë—É—Ä–≥–µ—Ä',ico:'üçî',cost:250,effect:'h+50'},
                {id:'f7',name:'–ü–∏—Ü—Ü–∞',ico:'üçï',cost:500,effect:'h+70'},
                {id:'f8',name:'–°—É—à–∏',ico:'üç£',cost:1000,effect:'h+50 l+20'},
                {id:'f9',name:'–°—Ç–µ–π–∫',ico:'ü•©',cost:2500,effect:'h+90 e+20'},
                {id:'f10',name:'–õ–æ–±—Å—Ç–µ—Ä',ico:'ü¶û',cost:5000,effect:'h+100 l+50'},
                {id:'f11',name:'–ó–æ–ª–æ—Ç–æ–π –°—Ç–µ–π–∫',ico:'üìÄ',cost:50000,effect:'h+100 e+100 l+100'},
                {id:'f12',name:'–ö–æ—Ñ–µ',ico:'‚òï',cost:150,effect:'e+40'},
                {id:'f13',name:'–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫',ico:'üîã',cost:300,effect:'e+60'}
            ],
            wear: [
                {id:'w1',name:'–ë–∞–Ω—Ç–∏–∫',ico:'üéÄ',cost:500,pos:'head'},
                {id:'w2',name:'–û—á–∫–∏',ico:'üëì',cost:1000,pos:'eyes'},
                {id:'w3',name:'–®–∞—Ä—Ñ',ico:'üß£',cost:1500,pos:'neck'},
                {id:'w4',name:'–§—É—Ç–±–æ–ª–∫–∞',ico:'üëï',cost:2000,pos:'body'},
                {id:'w5',name:'–ö–µ–ø–∫–∞',ico:'üß¢',cost:2500,pos:'head'},
                {id:'w6',name:'–ü–ª–∞—Ç—å–µ',ico:'üëó',cost:10000,pos:'body'},
                {id:'w7',name:'–ö–æ—Ä–æ–Ω–∞',ico:'üëë',cost:50000,pos:'head'},
                {id:'w8',name:'–ö–æ–ª—å—Ü–æ',ico:'üíç',cost:100000,pos:'body'},
                {id:'w9',name:'–ö—Ä—ã–ª—å—è',ico:'üßö',cost:250000,pos:'body'},
                {id:'w10',name:'–ü–ª–∞—â',ico:'üßõ',cost:150000,pos:'body'}
            ],
            house: [
                {id:'h1',name:'–ö–æ—Ä–æ–±–∫–∞',ico:'üì¶',cost:0,rent:0},
                {id:'h2',name:'–ö–æ–≤—Ä–∏–∫',ico:'üßò',cost:1000,rent:0},
                {id:'h3',name:'–ü–∞–ª–∞—Ç–∫–∞',ico:'‚õ∫',cost:5000,rent:0},
                {id:'h4',name:'–ö–≤–∞—Ä—Ç–∏—Ä–∞',ico:'üè¢',cost:25000,rent:500},
                {id:'h5',name:'–î–æ–º',ico:'üè°',cost:100000,rent:0},
                {id:'h6',name:'–í–∏–ª–ª–∞',ico:'‚õ≤',cost:500000,rent:5000},
                {id:'h7',name:'–ó–∞–º–æ–∫',ico:'üè∞',cost:2500000,rent:10000},
                {id:'h8',name:'–û—Å—Ç—Ä–æ–≤',ico:'üèùÔ∏è',cost:10000000,rent:0},
                {id:'h9',name:'–ú–∞—Ä—Å',ico:'ü™ê',cost:50000000,rent:0}
            ],
            gadget: [
                {id:'feeder',name:'–ö–æ—Ä–º—É—à–∫–∞',ico:'ü•£',cost:5000,dur:7,desc:'–ï–¥–∞ 7–¥–Ω'},
                {id:'sleeper',name:'–õ—é–ª—å–∫–∞',ico:'üõå',cost:5000,dur:7,desc:'–°–æ–Ω 7–¥–Ω'},
                {id:'heater',name:'–û–±–æ–≥—Ä–µ–≤–∞—Ç–µ–ª—å',ico:'üî•',cost:3000,dur:3,desc:'–¢–µ–ø–ª–æ 3–¥–Ω'},
                {id:'ac',name:'–ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä',ico:'‚ùÑÔ∏è',cost:3000,dur:3,desc:'–•–æ–ª–æ–¥ 3–¥–Ω'}
            ],
            buff: [
                {id:'b1',name:'–ó–µ–ª—å–µ –°–∫–æ—Ä–æ—Å—Ç–∏',ico:'üß™',cost:500,val:2.0,dur:60,desc:'x2 (1–º–∏–Ω)'},
                {id:'b2',name:'–≠–ª–∏–∫—Å–∏—Ä –õ—é–±–≤–∏',ico:'üíó',cost:5000,val:5.0,dur:300,desc:'x5 (5–º–∏–Ω)'}
            ]
        };

        const THOUGHTS = [
            "–õ—é–±–ª—é —Ç–µ–±—è!", "–¢—ã –º–æ—è –≤—Å–µ–ª–µ–Ω–Ω–∞—è", "–•–æ—á—É –Ω–∞ —Ä—É—á–∫–∏", "–ú—É—Ä-–º—É—Ä...", 
            "–°–∫—É—á–∞—é –ø–æ —Ç–µ–±–µ", "–¢—ã —Å–∞–º–∞—è –∫—Ä–∞—Å–∏–≤–∞—è", "–ì–¥–µ –µ–¥–∞?", "–•–æ—á—É –≥—É–ª—è—Ç—å", 
            "–¢—ã –º–æ–µ —Å—á–∞—Å—Ç—å–µ", "–ñ–¥—É —Ç–µ–±—è!", "–¢—ã –≤–∫—É—Å–Ω–æ –ø–∞—Ö–Ω–µ—à—å", "–û–±–Ω–∏–º–∏ –º–µ–Ω—è",
            "–û–ª—è —Ç–æ–ø!", "–õ—é–±–ª—é –±–æ–ª—å—à–µ –ø–∏—Ü—Ü—ã", "–¢—ã - –∫–æ—Å–º–æ—Å", "–°–∫–æ—Ä–æ —É–≤–∏–¥–∏–º—Å—è!",
            "–Ø —Å—á–∞—Å—Ç–ª–∏–≤ —Å —Ç–æ–±–æ–π", "–£–ª—ã–±–Ω–∏—Å—å!", "–¢—ã –º–æ–π –∫–æ—Ç–∏–∫", "–ú—ã –∫–æ–º–∞–Ω–¥–∞!"
        ];

        const SAD_THOUGHTS = [
            "–Ø –≥–æ–ª–æ–¥–Ω—ã–π...", "–ü–æ–∫–æ—Ä–º–∏ –º–µ–Ω—è...", "–ú–Ω–µ –≥—Ä—É—Å—Ç–Ω–æ", "–ñ–∏–≤–æ—Ç–∏–∫ —É—Ä—á–∏—Ç", "–¢—ã –º–µ–Ω—è –∑–∞–±—ã–ª–∞?", "–•–æ–ª–æ–¥–Ω–æ...", "–•–æ—á—É –∫—É—à–∞—Ç—å"
        ];
        
        const DOM = {
            mount: document.getElementById('calendar-root'), modal: document.getElementById('modal'),
            track: document.getElementById('path-bg'), active: document.getElementById('path-active'),
            plane: document.getElementById('plane-wrapper'), pct: document.getElementById('rt-percent'),
            toast: document.getElementById('toast'), garland: document.getElementById('garland'),
            body: document.body, coinDisp: document.getElementById('coin-display')
        };

        function init() {
            const saved = JSON.parse(localStorage.getItem(SETTINGS_KEY));
            if(saved) state.settings = { ...state.settings, ...saved };
            applySettings(); checkDaily(); checkCircadianRhythm(true); checkRentStatus(); 
            // Calculate Offline Decay
            const now = Date.now();
            if(state.pet.lastDecay) {
                const diff = now - state.pet.lastDecay;
                const hours = diff / (1000 * 3600);
                if(hours > 1) {
                    const drop = Math.min(50, Math.floor(hours * 3)); // 3 per hour offline
                    if(!state.pet.isSleeping) state.pet.energy = Math.max(0, state.pet.energy - drop);
                    state.pet.hunger = Math.max(0, state.pet.hunger - drop);
                    state.pet.love = Math.max(0, state.pet.love - drop);
                    state.pet.hygiene = Math.max(0, state.pet.hygiene - Math.floor(drop/2));
                    showToast(`–Ø —Å–∫—É—á–∞–ª! (–ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ —Å–Ω–∏–∑–∏–ª–∏—Å—å)`);
                }
            }
            state.pet.lastDecay = now;
            updatePetUI();
            
            setInterval(() => {
                const now = new Date();
                const d = now.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
                const t = now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute:'2-digit' });
                document.getElementById('real-clock').innerText = `${d} | ${t}`;
            }, 1000);

            const colors = ['led-warm', 'led-cool', 'led-pink'];
            for(let i=0; i<8; i++) {
                const seg = document.createElement('div'); seg.className = 'string-segment'; seg.style.animationDelay = `${i * 0.5}s`;
                for(let k=0; k<4; k++) {
                    const led = document.createElement('div'); led.className = `micro-led ${colors[(i+k)%3]}`;
                    led.style.top = `${Math.sin(k)*5 + 10}px`; led.style.animationDelay = `${Math.random()*2}s`;
                    seg.appendChild(led);
                }
                DOM.garland.appendChild(seg);
            }
            renderCal(); calcGraph(); window.addEventListener('resize', calcGraph);
            requestAnimationFrame(flightLoop); setInterval(tick, 1000); tick(); runParticles();
            
            setInterval(gameLoop, 1000); // 1s tick
            setInterval(petBehavior, 10000);
            setInterval(() => checkCircadianRhythm(false), 60000);
        }

        function applySettings() {
            const s = state.settings;
            document.querySelectorAll('.bg-mesh').forEach(b => b.classList.remove('active'));
            document.getElementById(`bg-${s.mode}`).classList.add('active');
            
            document.querySelectorAll('.dock-btn').forEach(b => b.style.background = 'transparent');
            if(s.mode === 'snow') document.getElementById('btn-snow').style.background = 'rgba(255,255,255,0.5)';
            if(s.mode === 'spring') document.getElementById('btn-spring').style.background = 'rgba(255,255,255,0.5)';
            if(s.mode === 'rain') document.getElementById('btn-rain').style.background = 'rgba(255,255,255,0.5)';

            DOM.body.classList.toggle('dark-mode', s.dark);
            DOM.garland.classList.toggle('active', s.garland);
        }
        function saveSettings() { localStorage.setItem(SETTINGS_KEY, JSON.stringify(state.settings)); }
        function savePet() { localStorage.setItem(PET_KEY, JSON.stringify(state.pet)); updatePetUI(); }

        function checkDaily() {
            const today = new Date().toDateString();
            if(state.pet.lastLogin !== today) {
                // Generate Daily Bank Rate (1% - 15%)
                state.pet.bankRate = Math.floor(Math.random() * 15) + 1;

                // Bank Interest
                if(state.pet.stockBank > 0) {
                     const interest = Math.floor(state.pet.stockBank * (state.pet.bankRate / 100));
                     state.pet.stockBank += interest;
                     showToast(`–ë–∞–Ω–∫ (${state.pet.bankRate}%): +${interest} –º–æ–Ω–µ—Ç`);
                }

                const diff = (Date.now() - new Date(state.pet.lastLoginTime || Date.now()).getTime()) / (1000 * 3600 * 24);
                if(diff > 1) { // Missed day
                    state.pet.streak = 0; // Reset streak
                } else {
                    state.pet.streak++;
                }
                state.pet.lastLogin = today; state.pet.lastLoginTime = Date.now();
                state.pet.coins += 50 + (state.pet.streak * 10);
                savePet(); showToast(`–ù–æ–≤—ã–π –¥–µ–Ω—å! +${50 + (state.pet.streak * 10)} üí∞`);
            }
        }

        function checkCircadianRhythm(isInit) {
            const h = new Date().getHours();
            const now = Date.now();
            const hasSleeper = state.pet.gadgets.sleeper > now;
            if(h >= 23 || h < 7) {
                if(hasSleeper && !state.pet.isSleeping) state.pet.isSleeping = true;
            } else {
                if(hasSleeper && state.pet.isSleeping) state.pet.isSleeping = false;
            }
            savePet();
        }

        function checkRentStatus() {
            if(!state.pet.house || !state.pet.house.rent) { document.getElementById('btn-rent').style.display = 'none'; return; }
            const currentMonth = new Date().getMonth();
            if(state.pet.rentPaidMonth !== currentMonth) {
                document.getElementById('btn-rent').style.display = 'block';
                document.getElementById('btn-rent').innerText = `üè† –û–ø–ª–∞—Ç–∏—Ç—å: ${state.pet.house.rent}`;
            } else document.getElementById('btn-rent').style.display = 'none';
        }

        window.payRent = () => {
            if(state.pet.coins >= state.pet.house.rent) {
                state.pet.coins -= state.pet.house.rent; state.pet.rentPaidMonth = new Date().getMonth();
                showToast("–û–ø–ª–∞—á–µ–Ω–æ!"); savePet(); checkRentStatus();
            } else showToast("–ù–µ—Ç –¥–µ–Ω–µ–≥!");
        }

        window.toggleSleep = () => { state.pet.isSleeping = !state.pet.isSleeping; savePet(); }
        window.washPet = () => { state.pet.hygiene=100; state.pet.energy = Math.max(0, state.pet.energy - 5); addExp(5); savePet(); showToast("–ß–∏—Å—Ç–æ!"); }
        
        // --- TRADING GAME ---
        let tradeInterval;
        let stockPrice = 100.00;
        let priceHistory = [];
        const tCanvas = document.getElementById('trade-chart');
        const tCtx = tCanvas.getContext('2d');

        window.openTrading = () => {
            document.getElementById('view-trading').classList.add('active');
            // Init price history
            priceHistory = [];
            for(let i=0; i<30; i++) priceHistory.push(100);
            stockPrice = 100;
            updateTradeUI();
            tradeInterval = setInterval(tradeTick, 1000);
        };
        window.closeTrading = () => {
            document.getElementById('view-trading').classList.remove('active');
            clearInterval(tradeInterval);
        };
        
        window.toggleTradeHelp = () => {
            document.getElementById('trade-help').classList.toggle('visible');
        }

        function tradeTick() {
            // Random Walk
            const change = (Math.random() - 0.5) * 5; 
            stockPrice = Math.max(10, stockPrice + change);
            priceHistory.push(stockPrice);
            if(priceHistory.length > 30) priceHistory.shift();
            drawChart();
            document.getElementById('stock-price').innerText = stockPrice.toFixed(2);
            const isUp = change >= 0;
            document.getElementById('stock-price').style.color = isUp ? '#30d158' : '#ff453a';
            document.getElementById('trend-arrow').innerText = isUp ? '‚Üó' : '‚Üò';
            document.getElementById('trend-arrow').style.color = isUp ? '#30d158' : '#ff453a';
        }

        function drawChart() {
            tCtx.clearRect(0,0,310,150);
            
            // Gradient Fill
            const isProfit = priceHistory[priceHistory.length-1] >= priceHistory[0];
            const color = isProfit ? '#30d158' : '#ff453a';
            
            const gradient = tCtx.createLinearGradient(0, 0, 0, 150);
            gradient.addColorStop(0, isProfit ? 'rgba(48, 209, 88, 0.2)' : 'rgba(255, 69, 58, 0.2)');
            gradient.addColorStop(1, 'rgba(0,0,0,0)');

            tCtx.beginPath();
            const step = 310 / 29;
            const max = Math.max(...priceHistory) + 10;
            const min = Math.min(...priceHistory) - 10;
            
            priceHistory.forEach((p, i) => {
                const y = 150 - ((p - min) / (max - min) * 130) - 10;
                if(i===0) tCtx.moveTo(0, y);
                else tCtx.lineTo(i*step, y);
            });
            
            tCtx.strokeStyle = color;
            tCtx.lineWidth = 2;
            tCtx.stroke();
            
            // Fill
            tCtx.lineTo(310, 150);
            tCtx.lineTo(0, 150);
            tCtx.fillStyle = gradient;
            tCtx.fill();
        }

        window.tradeBuy = () => {
            const cost = stockPrice;
            if(state.pet.coins >= cost) {
                state.pet.coins -= cost;
                state.pet.stocks++;
                updateTradeUI();
                savePet();
            } else showToast("–ù–µ—Ç –º–æ–Ω–µ—Ç!");
        }

        window.tradeSell = () => {
            if(state.pet.stocks > 0) {
                state.pet.coins += stockPrice;
                state.pet.stocks--;
                updateTradeUI();
                savePet();
            } else showToast("–ù–µ—Ç –∞–∫—Ü–∏–π!");
        }

        window.setMaxBank = () => {
            document.getElementById('bank-amount').value = Math.floor(state.pet.coins);
        }

        window.bankDeposit = () => {
            const el = document.getElementById('bank-amount');
            const val = parseInt(el.value);
            if(!val || val <= 0) { showToast("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É"); return; }
            
            if(state.pet.coins >= val) {
                state.pet.coins -= val;
                state.pet.stockBank += val;
                showToast(`–í–∫–ª–∞–¥: ${val} (–°—Ç–∞–≤–∫–∞ ${state.pet.bankRate}%)`);
                el.value = '';
                updateTradeUI();
                savePet();
            } else showToast("–ú–∞–ª–æ –º–æ–Ω–µ—Ç!");
        }

        window.bankWithdraw = () => {
            const el = document.getElementById('bank-amount');
            const val = parseInt(el.value);
            // If empty, withdraw all
            if(!val) {
                if(state.pet.stockBank > 0) {
                    state.pet.coins += state.pet.stockBank;
                    state.pet.stockBank = 0;
                    showToast("–°–Ω—è—Ç–æ –≤—Å—ë!");
                    updateTradeUI();
                    savePet();
                } else showToast("–ë–∞–Ω–∫ –ø—É—Å—Ç!");
                return;
            }

            if(val > 0 && state.pet.stockBank >= val) {
                state.pet.stockBank -= val;
                state.pet.coins += val;
                showToast(`–°–Ω—è—Ç–æ: ${val}`);
                el.value = '';
                updateTradeUI();
                savePet();
            } else showToast("–ú–∞–ª–æ —Å—Ä–µ–¥—Å—Ç–≤ –≤ –±–∞–Ω–∫–µ!");
        }

        function updateTradeUI() {
            document.getElementById('stock-owned').innerText = state.pet.stocks;
            document.getElementById('trade-cash').innerText = Math.floor(state.pet.coins);
            
            document.getElementById('bank-rate-disp').innerText = state.pet.bankRate + '%';
            document.getElementById('bank-balance').innerText = Math.floor(state.pet.stockBank);
            
            updatePetUI(); 
        }

        // --- RELAXED LOOPS ---
        function gameLoop() {
            const now = Date.now();
            const income = getAutoIncome();
            
            // Logic: Passive income only if healthy (Hunger > 0)
            if(income > 0 && state.pet.hunger > 0 && state.pet.love > 0) {
                let mult = 1;
                state.pet.activeBuffs = state.pet.activeBuffs.filter(b=>b.end>now);
                state.pet.activeBuffs.forEach(b=>mult*=b.val);
                const finalInc = state.pet.isSleeping ? (income * mult * 0.5) : (income * mult);
                state.pet.coins += finalInc;
            }

            // Sleep Regen
            if(state.pet.isSleeping) {
                state.pet.energy = Math.min(100, state.pet.energy + 0.5); // Slow regen
            }
            
            if(Math.random() < 0.0025) triggerRandomEvent();
            savePet();
        }

        function triggerRandomEvent() {
            const events = [
                {t: "–ù–∞—à–ª–∞ –º–æ–Ω–µ—Ç–∫—É! +50", c: 50},
                {t: "–ü–æ–π–º–∞–ª–∞ –±–∞–±–æ—á–∫—É! +20 Exp", x: 20},
                {t: "–•–æ—Ä–æ—à–∞—è –ø–æ–≥–æ–¥–∞! +10 ‚ù§Ô∏è", l: 10},
                {t: "–ü—Ç–∏—á–∫–∞ —Å–ø–µ–ª–∞! +10 ‚ö°", e: 10},
                {t: "–ù–∞—à–ª–∞ –∑–∞–Ω–∞—á–∫—É! +100", c: 100}
            ];
            const ev = events[Math.floor(Math.random()*events.length)];
            if(ev.c) state.pet.coins+=ev.c;
            if(ev.x) addExp(ev.x);
            if(ev.l) state.pet.love=Math.min(100, state.pet.love+ev.l);
            if(ev.e) state.pet.energy=Math.min(100, state.pet.energy+ev.e);
            showToast("‚ú® " + ev.t);
        }

        function addExp(a) {
            state.pet.exp+=a; 
            if(state.pet.exp>=state.pet.maxExp) { 
                state.pet.level++; state.pet.exp=0; state.pet.maxExp=Math.floor(state.pet.maxExp*1.5); 
                state.pet.energy=100; state.pet.coins+=100*state.pet.level; showToast("–£—Ä–æ–≤–µ–Ω—å UP! üéâ"); 
            }
        }
        function petBehavior() {
            if(state.pet.isSleeping) return;
            // Sad Thoughts Logic
            if(state.pet.hunger < 30 || state.pet.love < 30) {
                 const t = SAD_THOUGHTS[Math.floor(Math.random()*SAD_THOUGHTS.length)];
                 showThought(t);
            } else if(Math.random()>0.7) {
                showThought();
            }
        }

        function updatePetUI() {
            DOM.coinDisp.innerText = Math.floor(state.pet.coins);
            document.getElementById('shop-coins').innerText = Math.floor(state.pet.coins);
            document.getElementById('stat-balance').innerText = Math.floor(state.pet.coins);
            document.getElementById('casino-balance').innerText = Math.floor(state.pet.coins);
            
            document.getElementById('stat-click').innerText = getClickPower();
            document.getElementById('stat-auto').innerText = getAutoIncome();

            const pBars = ['hunger','love','energy','hygiene'];
            pBars.forEach(k => {
                const el = document.getElementById(`bar-${k}`);
                const val = state.pet[k];
                el.style.width = val+'%';
                if(val < 30) el.classList.add('danger'); else el.classList.remove('danger');
                document.getElementById(`txt-${k}`).innerText = `${Math.floor(val)}/100`;
            });

            document.getElementById('lvl-text').innerText = `–£—Ä. ${state.pet.level}`;
            document.getElementById('exp-fill').style.width = (state.pet.exp/state.pet.maxExp*100)+'%';
            
            const rentEl = document.getElementById('rent-info');
            if(state.pet.house && state.pet.house.rent > 0) {
                rentEl.style.display = 'block';
                const months = ['–Ø–Ω–≤–∞—Ä—è','–§–µ–≤—Ä–∞–ª—è','–ú–∞—Ä—Ç–∞','–ê–ø—Ä–µ–ª—è','–ú–∞—è','–ò—é–Ω—è','–ò—é–ª—è','–ê–≤–≥—É—Å—Ç–∞','–°–µ–Ω—Ç—è–±—Ä—è','–û–∫—Ç—è–±—Ä—è','–ù–æ—è–±—Ä—è','–î–µ–∫–∞–±—Ä—è'];
                rentEl.innerText = `–ê—Ä–µ–Ω–¥–∞ –æ–ø–ª–∞—á–µ–Ω–∞ –¥–æ –∫–æ–Ω—Ü–∞: ${months[state.pet.rentPaidMonth]}`;
            } else {
                rentEl.style.display = 'none';
            }

            const buffsDiv = document.getElementById('buffs-row'); buffsDiv.innerHTML='';
            const now = Date.now();
            if(state.pet.gadgets.feeder > now) buffsDiv.innerHTML+='<div class="buff-icon">ü•£</div>';
            if(state.pet.gadgets.heater > now) buffsDiv.innerHTML+='<div class="buff-icon">üî•</div>';
            state.pet.activeBuffs.forEach(b => buffsDiv.innerHTML+=`<div class="buff-icon">${b.ico}</div>`);

            const blob = document.getElementById('pet-blob');
            const face = document.getElementById('pet-face');
            const accRoot = document.getElementById('pet-acc-root');
            accRoot.innerHTML = ''; 
            
            document.getElementById('sleep-overlay').classList.toggle('active', state.pet.isSleeping);
            blob.classList.toggle('sleeping', state.pet.isSleeping);
            
            // Sad Face Logic
            const isSad = (state.pet.hunger < 30 || state.pet.love < 30 || state.pet.hygiene < 30);
            blob.classList.toggle('sad', isSad);

            if(state.pet.isSleeping) { 
                face.innerText = 'üò¥'; document.getElementById('btn-sleep').innerText="‚òÄÔ∏è"; 
            } else if(isSad) {
                face.innerText = 'ü•∫'; // Crying/Begging face
                document.getElementById('btn-sleep').innerText="üò¥";
            } else { 
                document.getElementById('btn-sleep').innerText="üò¥"; 
                face.innerText = (state.pet.love>90?'üòª':'üò∫'); 
            }
            
            // Render OUTFIT (Multi-slot)
            if(!state.pet.isSleeping) {
                // Order doesn't strictly matter for absolute div, but we iterate
                Object.values(state.pet.outfit).forEach(item => {
                    if(item) {
                        const ac = document.createElement('div');
                        // No extra classes, just item specific one
                        ac.className = `acc-item acc-${item.pos || 'body'}`;
                        ac.innerText = item.ico;
                        accRoot.appendChild(ac);
                    }
                });
            }

            document.getElementById('house-bg').innerText = (state.pet.house && state.pet.house.id!=='box') ? state.pet.house.ico : 'üì¶';
        }

        // --- BALANCED CLICK ---
        window.petClick = (e) => {
            if(state.pet.isSleeping) return;
            
            // Check resources
            if(state.pet.energy <= 0 || state.pet.hunger <= 0) {
                showToast("–ü–∏—Ç–æ–º–µ—Ü —É—Å—Ç–∞–ª –∏–ª–∏ –≥–æ–ª–æ–¥–µ–Ω!");
                return;
            }

            const power = getClickPower();
            
            // Stats cost per click (Balanced)
            state.pet.energy = Math.max(0, state.pet.energy - 0.5);
            state.pet.hunger = Math.max(0, state.pet.hunger - 0.3);
            state.pet.hygiene = Math.max(0, state.pet.hygiene - 0.2);
            state.pet.love = Math.min(100, state.pet.love + 0.1);

            const float = document.createElement('div'); float.className='click-float';
            float.innerText = `+${power}`;
            float.style.left=(e.clientX-10)+'px'; float.style.top=(e.clientY-40)+'px';
            document.body.appendChild(float); setTimeout(()=>float.remove(),800);
            state.pet.coins += power; addExp(1); savePet();
        }
        function showThought(t) { 
            const el = document.getElementById('pet-thought'); el.innerText=t||THOUGHTS[Math.floor(Math.random()*THOUGHTS.length)];
            el.classList.add('show'); setTimeout(()=>el.classList.remove('show'),2000); 
        }

        // CASINO - REAL WHEEL LOGIC
        window.openCasino = () => { document.getElementById('view-casino').classList.add('active'); };
        
        window.spinRoulette = (choice) => {
            const betInput = document.getElementById('casino-bet');
            const bet = parseInt(betInput.value);
            const wheel = document.getElementById('roulette-wheel');
            
            if(!bet || bet <= 0) { showToast("–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É! ‚ö†Ô∏è"); return; }
            if(state.pet.coins < bet) { showToast("–ù–µ—Ç –º–æ–Ω–µ—Ç! üí∏"); return; }

            state.pet.coins -= bet;
            savePet();
            updatePetUI();
            
            wheel.style.transition = 'none';
            wheel.style.transform = 'rotate(0deg)';
            wheel.offsetHeight;

            const result = Math.floor(Math.random() * 15); 
            const segSize = 360 / 15;
            const targetAngle = (result * segSize) + (segSize / 2);
            const spin = 1800 + (360 - targetAngle); 
            
            wheel.style.transition = 'transform 3s cubic-bezier(0.1, 0.9, 0.2, 1)';
            wheel.style.transform = `rotate(${spin}deg)`;

            setTimeout(() => {
                let color = 'green';
                if(result === 0) color = 'green';
                else if(result % 2 !== 0) color = 'red'; 
                else color = 'black'; 
                
                if(choice === color) {
                    let win = 0;
                    if(color === 'green') win = bet * 14;
                    else win = bet * 2;
                    state.pet.coins += win;
                    showToast(`–ü–æ–±–µ–¥–∞! ${color.toUpperCase()}! +${win} üí∞`);
                } else {
                    showToast(`–í—ã–ø–∞–ª–æ ${color}. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ!`);
                }
                savePet();
                updatePetUI();

            }, 3000);
        }

        // SHOP
        let curTab = 'food';
        window.openShop = () => { document.getElementById('shop-modal').classList.add('active'); switchShop('food'); };
        window.closeShop = () => document.getElementById('shop-modal').classList.remove('active');
        window.switchShop = (t) => {
            curTab = t; document.querySelectorAll('.shop-tab').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            const list = document.getElementById('shop-list'); list.innerHTML = '';
            
            let items = [];
            if(t === 'upgrade') {
                 items.push({
                     id:'click_up', 
                     name:`–ö–ª–∏–∫ –£—Ä.${state.pet.clickLevel}`, 
                     ico:'üí™', 
                     cost: getClickUpgradeCost(), 
                     type:'u_click', 
                     desc:`–°–∏–ª–∞: ${getClickPower()} ‚ûî ${Math.floor(1 * Math.pow(1.2, state.pet.clickLevel+1))}`
                 });
                 items.push({
                     id:'auto_up', 
                     name:`–ê–≤—Ç–æ –£—Ä.${state.pet.autoLevel}`, 
                     ico:'‚öôÔ∏è', 
                     cost: getAutoUpgradeCost(), 
                     type:'u_auto', 
                     desc:`–î–æ—Ö–æ–¥: ${getAutoIncome()} ‚ûî ${Math.floor(1 * Math.pow(1.15, state.pet.autoLevel+1))}/—Å–µ–∫`
                 });
            } else {
                items = SHOP[t];
            }

            items.forEach(i => {
                const el = document.createElement('div');
                const owned = state.pet.inventory.includes(i.id) || state.pet.inventory.includes('house_'+i.id);
                // Check if equipped in slot
                let equipped = false;
                if(t === 'wear') equipped = state.pet.outfit[i.pos] && state.pet.outfit[i.pos].id === i.id;
                else if(t === 'house') equipped = state.pet.house && state.pet.house.id === i.id;

                el.className = `shop-item ${owned && t!=='food' && t!=='buff' ? 'owned' : ''} ${equipped ? 'selected' : ''}`;
                
                let txt = i.cost + ' üí∞';
                if(t === 'wear') txt = equipped ? '–°–Ω—è—Ç—å' : (owned ? '–ù–∞–¥–µ—Ç—å' : txt);
                if(t === 'house') txt = equipped ? '–ñ–∏–≤—É' : (owned && i.rent===0 ? '–ü–µ—Ä–µ–µ—Ö–∞—Ç—å' : (i.rent>0 ? `–ê—Ä–µ–Ω–¥–∞ ${i.cost}` : txt));
                if(t === 'gadget' && state.pet.gadgets[i.id] > Date.now()) txt = "–ê–∫—Ç–∏–≤–Ω–æ";
                if(t === 'upgrade') txt = `–£–ª—É—á—à–∏—Ç—å: ${i.cost} üí∞`;

                el.innerHTML = `<div style="font-size:30px">${i.ico}</div><div style="font-size:12px;font-weight:700">${i.name}</div><div class="shop-desc">${i.desc || ''}</div><div class="shop-price">${txt}</div>`;
                el.onclick = () => buyItem(i, t);
                list.appendChild(el);
            });
        };

        function buyItem(i, t) {
            // MULTI SLOT LOGIC FOR WEAR
            if(t==='wear') {
                const slot = i.pos || 'body';
                // Toggle Off
                if(state.pet.outfit[slot] && state.pet.outfit[slot].id === i.id) {
                    state.pet.outfit[slot] = null;
                    savePet(); switchShop(t); updatePetUI();
                    return;
                }
                // Check Cost
                if(state.pet.coins < i.cost && !state.pet.inventory.includes(i.id)) { showToast("–ú–∞–ª–æ –º–æ–Ω–µ—Ç!"); return; }
                
                // Buy if needed
                if(!state.pet.inventory.includes(i.id)) { 
                    state.pet.coins -= i.cost; 
                    state.pet.inventory.push(i.id); 
                }
                
                // Equip
                state.pet.outfit[slot] = i;
                showToast("–°—Ç–∏–ª—å!");
                savePet(); switchShop(t); updatePetUI();
                return;
            }

            if(t==='house' && state.pet.house && state.pet.house.id===i.id) return; 

            if(state.pet.coins < i.cost && !state.pet.inventory.includes(i.id) && !state.pet.inventory.includes('house_'+i.id)) { showToast("–ú–∞–ª–æ –º–æ–Ω–µ—Ç!"); return; }

            if(t==='food') {
                const parts = i.effect.split(' ');
                parts.forEach(p => {
                    const v = parseInt(p.split('+')[1]);
                    if(p.includes('h+')) state.pet.hunger = Math.min(100, state.pet.hunger+v);
                    if(p.includes('e+')) state.pet.energy = Math.min(100, state.pet.energy+v);
                    if(p.includes('l+')) state.pet.love = Math.min(100, state.pet.love+v);
                });
                showToast("–í–∫—É—Å–Ω–æ!"); addExp(5);
                state.pet.coins -= i.cost;
            } else if (t==='house') {
                const hid = 'house_'+i.id;
                if(i.rent > 0) { 
                     state.pet.coins -= i.cost; state.pet.house = i; state.pet.rentPaidMonth = new Date().getMonth(); showToast("–° –Ω–æ–≤–æ—Å–µ–ª—å–µ–º!");
                } else { 
                    if(!state.pet.inventory.includes(hid)) { state.pet.coins-=i.cost; state.pet.inventory.push(hid); }
                    state.pet.house = i; showToast("–î–æ–º –º–∏–ª—ã–π –¥–æ–º!");
                }
                checkRentStatus();
            } else if (t==='gadget') {
                if(state.pet.gadgets[i.id]>Date.now()) return;
                state.pet.coins-=i.cost; state.pet.gadgets[i.id] = Date.now() + (i.dur*86400000); showToast("–†–∞–±–æ—Ç–∞–µ—Ç!");
            } else if (t==='upgrade') {
                state.pet.coins-=i.cost; 
                if(i.type==='u_click') state.pet.clickLevel++;
                if(i.type==='u_auto') state.pet.autoLevel++;
                showToast("–£–ª—É—á—à–µ–Ω–æ! üí™");
            } else if (t==='buff') {
                 state.pet.coins-=i.cost;
                 state.pet.activeBuffs.push({id:i.id, val:i.val, end:Date.now()+(i.dur*1000), ico:i.ico});
                 showToast("–ú–∞–≥–∏—è! ‚ú®");
            }
            savePet(); switchShop(t); updatePetUI();
        }

        window.setView = (v) => {
            document.querySelectorAll('.view-section').forEach(el=>el.classList.remove('active-view'));
            document.getElementById(`view-${v}`).classList.add('active-view');
            document.getElementById('btn-view-cal').classList.toggle('active', v==='calendar');
            document.getElementById('btn-view-pet').classList.toggle('active', v==='pet');
        }
        window.setMode = (m) => { state.settings.mode=m; applySettings(); saveSettings(); }
        window.toggleGarland = () => { state.settings.garland=!state.settings.garland; applySettings(); saveSettings(); }
        window.toggleDark = () => { state.settings.dark=!state.settings.dark; applySettings(); saveSettings(); }
        window.doBarrelRoll = () => {
            const icon = document.getElementById('plane-icon'); icon.style.animation = 'barrelRoll 1s ease-in-out';
            setTimeout(() => icon.style.animation = '', 1000); showToast("–í–∂—É—É—É—Ö! ‚úàÔ∏è");
        }
        function tick() {
            const rem = END - new Date();
            if(rem<=0) { document.getElementById('timer').innerText="–ú–´ –í–ú–ï–°–¢–ï!"; return; }
            const d = Math.floor(rem/86400000);
            const h = Math.floor((rem%86400000)/3600000);
            const m = Math.floor((rem%3600000)/60000);
            const s = Math.floor((rem%60000)/1000);
            document.getElementById('timer').innerText = `${d}–¥ ${("0"+h).slice(-2)}:${("0"+m).slice(-2)}:${("0"+s).slice(-2)}`;
        }
        function renderCal() { 
             DOM.mount.innerHTML = '';
            let ptr = new Date(START);
            const today = new Date(); today.setHours(0,0,0,0);
            while(ptr <= END) {
                const y = ptr.getFullYear(); const m = ptr.getMonth();
                const card = document.createElement('div'); card.className = 'glass-panel';
                const name = ptr.toLocaleString('ru', { month: 'long' });
                const ico = (m<=1 || m===11) ? '‚ùÑÔ∏è' : 'üå∏';
                card.innerHTML = `<div class="month-title">${ico} <span style="text-transform:capitalize">${name}</span></div>`;
                const wh = document.createElement('div'); wh.className = 'week-header';
                WEEKDAYS.forEach(wd => {
                    const el = document.createElement('div'); el.className = 'week-day'; el.innerText = wd;
                    wh.appendChild(el);
                });
                card.appendChild(wh);
                const grid = document.createElement('div'); grid.className = 'cal-grid';
                const f = new Date(y,m,1);
                let skip = f.getDay() - 1; if(skip===-1) skip=6;
                for(let i=0; i<skip; i++) grid.appendChild(document.createElement('div'));
                const days = new Date(y,m+1,0).getDate();
                for(let d=1; d<=days; d++) {
                    const date = new Date(y,m,d);
                    if(date < START && m===START.getMonth()) { grid.appendChild(document.createElement('div')); continue; }
                    if(date > END) break;
                    const k = date.toISOString().split('T')[0];
                    const fut = date > today;
                    const isT = date.getTime()===today.getTime();
                    const op = state.opened[k];
                    const holKey = `${m}-${d}`;
                    const el = document.createElement('div'); el.className = 'day-item';
                    el.innerText = d;
                    if(HOLIDAYS[holKey]) {
                        el.classList.add('holiday');
                        const hIco = document.createElement('div'); hIco.className = 'holiday-icon'; hIco.innerText = HOLIDAYS[holKey];
                        el.appendChild(hIco);
                    }
                    if(fut) {
                        el.classList.add('future');
                        el.onclick = () => { const dateStr = date.toLocaleString('ru', { day: 'numeric', month: 'long' }); showToast(`–ü–æ—Ç–µ—Ä–ø–∏, –ë–∏–±–∞! –û—Ç–∫—Ä—ã—Ç—å –º–æ–∂–Ω–æ ${dateStr}`); };
                    } else {
                        if(isT) el.classList.add('today');
                        if(op) { el.classList.add('opened'); addHeart(el); }
                        else if(!isT) el.classList.add('missed');
                        el.onclick = () => {
                            if(!state.opened[k]) { state.opened[k]=true; state.pet.coins += 50; savePet(); showToast("–ù–∞–π–¥–µ–Ω–æ: 50 –º–æ–Ω–µ—Ç! üí∞"); }
                            localStorage.setItem(DATA_KEY, JSON.stringify(state.opened));
                            el.classList.add('opened'); el.classList.remove('missed');
                            if(isT) el.classList.remove('today');
                            addHeart(el);
                            const diff = Math.floor((date - START)/(86400000));
                            openLetter(date.toLocaleString('ru', { day: 'numeric', month: 'long' }), quotes[diff % quotes.length]);
                        }
                    }
                    grid.appendChild(el);
                }
                card.appendChild(grid); DOM.mount.appendChild(card);
                ptr = new Date(y,m+1,1);
            }
        }
        function calcGraph() {
            const el = document.getElementById('flight-viz'); if(!el) return;
            const w = el.offsetWidth; const h = el.offsetHeight;
            const d = `M 20 ${h-30} Q ${w/2} -20 ${w-20} ${h-50}`;
            DOM.track.setAttribute('d', d); DOM.active.setAttribute('d', d);
            len = DOM.track.getTotalLength();
        }
        function flightLoop() { 
             const tot = END - START; const pass = new Date() - START;
            let p = pass / tot; if(p<0) p=0; if(p>1) p=1;
            if(DOM.active && DOM.track) {
                DOM.active.style.strokeDasharray = len; DOM.active.style.strokeDashoffset = len * (1 - p);
                const pt = DOM.track.getPointAtLength(len * p);
                const next = DOM.track.getPointAtLength(Math.min(len, len*p + 2));
                const ang = Math.atan2(next.y - pt.y, next.x - pt.x) * 180 / Math.PI;
                const hover = Math.sin(Date.now() / 800) * 3;
                DOM.plane.style.transform = `translate(${pt.x - 20}px, ${pt.y - 20 + hover}px) rotate(${ang}deg)`;
                DOM.pct.innerText = (p * 100).toFixed(5) + '%'; DOM.pct.style.transform = `rotate(${-ang}deg)`;
            }
            requestAnimationFrame(flightLoop);
        }
        function runParticles() { 
            const c = document.getElementById('canvas-fx'); const ctx = c.getContext('2d');
            const rsz = () => { c.width = window.innerWidth; c.height = window.innerHeight; };
            window.addEventListener('resize', rsz); rsz();
            let pts = []; for(let i=0; i<80; i++) pts.push({x: Math.random()*c.width, y: Math.random()*c.height, z: Math.random()*0.5 + 0.5, s: Math.random()*Math.PI*2, v: Math.random()*0.02});
            function anim() {
                ctx.clearRect(0,0,c.width,c.height); const m = state.settings.mode; const isDark = state.settings.dark;
                pts.forEach(p => {
                    p.y += p.z * (m==='rain' ? 12 : 1); p.x += Math.sin(p.y*0.003 + p.s)*0.5; p.s += p.v;
                    if(p.y > c.height) { p.y = -20; p.x = Math.random()*c.width; }
                    ctx.beginPath();
                    if(m === 'snow') {
                        const rad = p.z * 3; const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, rad);
                        grad.addColorStop(0, `rgba(255,255,255,${0.8*p.z})`); grad.addColorStop(1, `rgba(255,255,255,0)`);
                        ctx.fillStyle = grad; ctx.arc(p.x, p.y, rad, 0, Math.PI*2); ctx.fill();
                    } else if(m === 'spring') {
                        ctx.save(); ctx.translate(p.x, p.y); ctx.scale(Math.cos(p.s), 1); ctx.rotate(p.s * 0.5);
                        ctx.fillStyle = `rgba(255, 192, 203, ${p.z})`;
                        ctx.moveTo(0,0); ctx.bezierCurveTo(5, -5, 10, 0, 0, 10); ctx.bezierCurveTo(-10, 0, -5, -5, 0, 0); ctx.fill(); ctx.restore();
                    } else if(m === 'rain') {
                        const color = isDark ? `rgba(255,255,255,${0.3*p.z})` : `rgba(80, 100, 130, ${0.5*p.z})`;
                        ctx.strokeStyle = color; ctx.lineWidth = 1; ctx.moveTo(p.x, p.y); ctx.lineTo(p.x - 1, p.y + 15*p.z); ctx.stroke();
                    }
                }); requestAnimationFrame(anim);
            } anim();
        }
        function openLetter(d, q) { document.getElementById('m-date').innerText = d; document.getElementById('m-text').innerText = q.t; document.getElementById('m-source').innerText = "‚Äî " + q.s; DOM.modal.classList.add('active'); }
        window.closeModal = () => DOM.modal.classList.remove('active');
        let tm;
        function showToast(t) { document.getElementById('toast-text').innerText = t; DOM.toast.classList.add('visible'); clearTimeout(tm); tm = setTimeout(()=>DOM.toast.classList.remove('visible'), 2500); }
        function addHeart(p) { if(p.querySelector('.mini-heart')) return; const h = document.createElement('span'); h.className = 'mini-heart'; h.innerText = '‚ù§'; p.appendChild(h); }

        init();
    </script>
</body>
</html>
